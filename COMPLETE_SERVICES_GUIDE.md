# ğŸš€ åƒµå°¸ç½‘ç»œæ¥ç®¡é›†æˆå¹³å° - å®Œæ•´äº”æœåŠ¡å¯åŠ¨æŒ‡å—

## ğŸ“‹ äº”ä¸ªæ ¸å¿ƒæœåŠ¡æ¸…å•

| åºå· | æœåŠ¡åç§° | ç«¯å£ | è¯´æ˜ | æ—¥å¿—æ–‡ä»¶ |
|------|---------|------|------|----------|
| 1 | **å¹³å°åç«¯API** | 8000 | FastAPIæœåŠ¡ï¼Œæä¾›æ‰€æœ‰APIæ¥å£ | `backend/logs/api_backend.log` |
| 2 | **æ—¥å¿—å¤„ç†å™¨** | - | å¤„ç†å®æ—¶æ—¥å¿—æ•°æ®ï¼Œ**éœ€è¦Redis** | `backend/logs/log_processor.log` |
| 3 | **ç»Ÿè®¡èšåˆå™¨** | - | æ¯30åˆ†é’Ÿèšåˆç»Ÿè®¡æ•°æ® | `backend/logs/aggregator.log` |
| 4 | **Timesetæ•°æ®ç¡®ä¿å™¨** | - | æ¯3å°æ—¶ç¡®ä¿æœ€è¿‘30å¤©æ•°æ®å®Œæ•´æ€§ | `backend/logs/timeset_ensurer.log` |
| 5 | **å‰ç«¯ç•Œé¢** | 9000 | React + Viteå¼€å‘æœåŠ¡å™¨ | ç»ˆç«¯è¾“å‡º |

## ğŸ”§ åŸºç¡€è®¾æ–½æœåŠ¡

| æœåŠ¡ | ç±»å‹ | ç«¯å£ | è¯´æ˜ |
|------|------|------|------|
| **MySQLæ•°æ®åº“** | Dockerå®¹å™¨ | 3306 | æ•°æ®å­˜å‚¨ |
| **Redis** | ç³»ç»ŸæœåŠ¡ | 6379 | **æ—¥å¿—å¤„ç†å™¨å¿…éœ€** |

---

## âš¡ ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™ï¼ˆé¦–æ¬¡ï¼‰
chmod +x start_all_services.sh

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start_all_services.sh
```

### å¯åŠ¨é¡ºåº
1. âœ… MySQL (Docker) - è‡ªåŠ¨æ£€æŸ¥å¹¶å¯åŠ¨
2. âœ… Redis - è‡ªåŠ¨æ£€æŸ¥å¹¶å¯åŠ¨
3. âœ… å¹³å°åç«¯API
4. âœ… æ—¥å¿—å¤„ç†å™¨
5. âœ… ç»Ÿè®¡èšåˆå™¨
6. âœ… Timesetæ•°æ®ç¡®ä¿å™¨
7. âœ… å‰ç«¯ç•Œé¢

---

## ğŸ›‘ åœæ­¢æ‰€æœ‰æœåŠ¡

```bash
./stop_all_services.sh
```

**æ³¨æ„**: 
- MySQLå’ŒRedisä¸ä¼šè‡ªåŠ¨åœæ­¢
- å¦‚éœ€åœæ­¢MySQL: `sudo docker stop mysql`
- å¦‚éœ€åœæ­¢Redis: `sudo systemctl stop redis-server`

---

## ğŸ“Š Redisé…ç½®è¯´æ˜

### âœ… Rediså·²å®‰è£…å¹¶é…ç½®

RedisæœåŠ¡å·²ç»æˆåŠŸå®‰è£…å¹¶é…ç½®å®Œæˆï¼š

```bash
# æ£€æŸ¥RedisçŠ¶æ€
redis-cli ping
# åº”è¿”å›: PONG

# æŸ¥çœ‹RedisæœåŠ¡çŠ¶æ€
sudo systemctl status redis-server

# æ‰‹åŠ¨å¯åŠ¨Redis
sudo systemctl start redis-server

# æ‰‹åŠ¨åœæ­¢Redis
sudo systemctl stop redis-server

# è®¾ç½®Rediså¼€æœºè‡ªå¯
sudo systemctl enable redis-server
```

### Redisåœ¨æ—¥å¿—å¤„ç†å™¨ä¸­çš„ä½œç”¨

æ—¥å¿—å¤„ç†å™¨ä½¿ç”¨Redisä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼š
- **æ¥æ”¶æ—¥å¿—æ•°æ®**: è¿œç¨‹èœœç½ä¸Šä¼ æ—¥å¿—åˆ°API
- **é˜Ÿåˆ—ç¼“å†²**: Redisä¸´æ—¶å­˜å‚¨å¾…å¤„ç†çš„æ—¥å¿—
- **å¼‚æ­¥å¤„ç†**: Workerä»Redisé˜Ÿåˆ—ä¸­å–å‡ºæ—¥å¿—è¿›è¡Œå¤„ç†
- **æ•°æ®å…¥åº“**: å¤„ç†åçš„æ•°æ®å†™å…¥MySQL

**å¦‚æœRedisæœªè¿è¡Œï¼Œæ—¥å¿—å¤„ç†å™¨å°†æ— æ³•æ­£å¸¸å·¥ä½œï¼**

---

## ğŸ” æœåŠ¡çŠ¶æ€æ£€æŸ¥

### æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„æœåŠ¡

```bash
# æŸ¥çœ‹æ‰€æœ‰å¹³å°è¿›ç¨‹
ps aux | grep -E "(uvicorn|python3.*(main|aggregator|ensure)|node.*vite)" | grep -v grep

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tuln | grep -E "(8000|9000|3306|6379)"

# æŸ¥çœ‹Dockerå®¹å™¨
sudo docker ps | grep mysql

# æŸ¥çœ‹RedisçŠ¶æ€
redis-cli ping
```

### æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆæŒ‰Ctrl+Cé€€å‡ºï¼‰
tail -f backend/logs/api_backend.log      # åç«¯API
tail -f backend/logs/log_processor.log    # æ—¥å¿—å¤„ç†å™¨
tail -f backend/logs/aggregator.log       # ç»Ÿè®¡èšåˆå™¨
tail -f backend/logs/timeset_ensurer.log  # Timesetç¡®ä¿å™¨

# æŸ¥çœ‹æœ€å50è¡Œæ—¥å¿—
tail -50 backend/logs/api_backend.log
```

---

## ğŸŒ è®¿é—®åœ°å€

å¯åŠ¨æˆåŠŸåï¼Œè®¿é—®ä»¥ä¸‹åœ°å€ï¼š

- **ğŸ–¥ï¸ å‰ç«¯ç®¡ç†ç•Œé¢**: http://localhost:9000/
- **ğŸ“š åç«¯APIæ–‡æ¡£**: http://localhost:8000/docs
- **ğŸ”— APIæ ¹è·¯å¾„**: http://localhost:8000/
- **ğŸŒ å¤–ç½‘è®¿é—®**: http://æœåŠ¡å™¨IP:9000/ (å¦‚æœé˜²ç«å¢™å…è®¸)

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: Redisè¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥Redisæ˜¯å¦è¿è¡Œ
redis-cli ping

# å¦‚æœè¿”å›é”™è¯¯ï¼Œå¯åŠ¨Redis
sudo systemctl start redis-server

# æŸ¥çœ‹Redisæ—¥å¿—
sudo journalctl -u redis-server -n 50
```

### é—®é¢˜2: æ—¥å¿—å¤„ç†å™¨å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
tail -50 backend/logs/log_processor.log

# å¸¸è§åŸå› ï¼š
# 1. Redisæœªè¿è¡Œ - å¯åŠ¨Redis
# 2. ç¼ºå°‘Pythonä¾èµ– - pip3 install -r backend/requirements.txt
# 3. æ•°æ®åº“è¿æ¥å¤±è´¥ - æ£€æŸ¥MySQLå®¹å™¨çŠ¶æ€
```

### é—®é¢˜3: ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹8000ç«¯å£å ç”¨
sudo lsof -i :8000

# æŸ¥çœ‹9000ç«¯å£å ç”¨
sudo lsof -i :9000

# æ€æ‰å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo kill -9 <PID>
```

### é—®é¢˜4: MySQLå®¹å™¨æœªè¿è¡Œ

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
sudo docker ps -a | grep mysql

# å¯åŠ¨MySQLå®¹å™¨
sudo docker start mysql

# æŸ¥çœ‹MySQLæ—¥å¿—
sudo docker logs mysql
```

### é—®é¢˜5: å‰ç«¯å¯åŠ¨å¤±è´¥

```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version  # å¿…é¡» >= 16

# é‡æ–°å®‰è£…ä¾èµ–
cd fronted
rm -rf node_modules
npm install

# æ¸…é™¤ç¼“å­˜
npm cache clean --force
```

---

## ğŸ“ æœåŠ¡æ–‡ä»¶ä½ç½®

### åç«¯æœåŠ¡
- **ä¸»ç¨‹åº**: `backend/main.py`
- **æ—¥å¿—å¤„ç†å™¨**: `backend/log_processor/main.py`
- **ç»Ÿè®¡èšåˆå™¨**: `backend/stats_aggregator/aggregator.py`
- **Timesetç¡®ä¿å™¨**: `backend/scripts/ensure_timeset_data.py`
- **é…ç½®æ–‡ä»¶**: `backend/config.py`

### å‰ç«¯æœåŠ¡
- **ä¸»ç›®å½•**: `fronted/`
- **é…ç½®**: `fronted/package.json`
- **Viteé…ç½®**: `fronted/vite.config.js`

### æ—¥å¿—ç›®å½•
- **æ‰€æœ‰æ—¥å¿—**: `backend/logs/`
- **PIDæ–‡ä»¶**: `backend/logs/*.pid`

---

## ğŸ”„ æœåŠ¡ä¾èµ–å…³ç³»

```
MySQL (Docker) â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚
Redis â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                     â”‚   â”‚
                     â†“   â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   å¹³å°åç«¯API (8000)       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†‘
                â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚
       â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¥å¿—å¤„ç†å™¨   â”‚   â”‚  ç»Ÿè®¡èšåˆå™¨     â”‚
â”‚ (éœ€è¦Redis)  â”‚   â”‚  (30åˆ†é’Ÿ)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Timesetç¡®ä¿å™¨   â”‚
                  â”‚  (3å°æ—¶)        â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   å‰ç«¯ç•Œé¢ (9000)          â”‚
       â”‚   â†“ HTTPè¯·æ±‚ â†“             â”‚
       â”‚   å¹³å°åç«¯API              â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ å¼€å‘å»ºè®®

### æ¨èå·¥ä½œæµ

1. **åç«¯å¼€å‘**: uvicornä½¿ç”¨`--reload`å‚æ•°ï¼Œä»£ç ä¿®æ”¹è‡ªåŠ¨é‡å¯
2. **å‰ç«¯å¼€å‘**: Viteæä¾›çƒ­æ›´æ–°ï¼Œä¿®æ”¹åè‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨
3. **æ—¥å¿—ç›‘æ§**: ä½¿ç”¨`tail -f`å®æ—¶æŸ¥çœ‹æ—¥å¿—
4. **æ•°æ®åº“æ“ä½œ**: ç›´æ¥è¿æ¥Docker MySQLå®¹å™¨

### å¸¸ç”¨å‘½ä»¤

```bash
# è¿æ¥MySQLæ•°æ®åº“
sudo docker exec -it mysql mysql -uroot -pMatrix123 botnet

# è¿æ¥Redis
redis-cli

# æŸ¥çœ‹Redisä¸­çš„æ—¥å¿—é˜Ÿåˆ—
redis-cli LLEN log_queue

# é‡å¯å•ä¸ªæœåŠ¡ï¼ˆä»¥åç«¯ä¸ºä¾‹ï¼‰
pkill -f uvicorn
cd backend && nohup uvicorn main:app --host 0.0.0.0 --port 8000 --reload > logs/api_backend.log 2>&1 &
```

---

## âœ… å¯åŠ¨æ£€æŸ¥æ¸…å•

å¯åŠ¨å‰ç¡®è®¤ï¼š
- [ ] MySQLå®¹å™¨æ­£åœ¨è¿è¡Œ
- [ ] RedisæœåŠ¡å·²å¯åŠ¨
- [ ] Pythonä¾èµ–å·²å®‰è£…
- [ ] Node.jsç‰ˆæœ¬ >= 16
- [ ] ç«¯å£8000å’Œ9000æœªè¢«å ç”¨
- [ ] æ•°æ®åº“é…ç½®æ­£ç¡® (backend/config.py)
- [ ] IPåœ°ç†ä½ç½®æ•°æ®åº“æ–‡ä»¶å­˜åœ¨

å¯åŠ¨åéªŒè¯ï¼š
- [ ] åç«¯APIå“åº”æ­£å¸¸: `curl http://localhost:8000/`
- [ ] APIæ–‡æ¡£å¯è®¿é—®: http://localhost:8000/docs
- [ ] Redisè¿æ¥æ­£å¸¸: `redis-cli ping`
- [ ] å‰ç«¯ç•Œé¢å¯è®¿é—®: http://localhost:9000/
- [ ] æ‰€æœ‰æ—¥å¿—æ–‡ä»¶æ­£å¸¸è¾“å‡º
- [ ] æ²¡æœ‰é”™è¯¯ä¿¡æ¯

---

## ğŸ¯ æ€»ç»“

**å®Œæ•´å¹³å° = 2ä¸ªåŸºç¡€è®¾æ–½ + 5ä¸ªåº”ç”¨æœåŠ¡**

**åŸºç¡€è®¾æ–½**:
1. MySQL (Docker)
2. Redis (å¿…éœ€ï¼)

**åº”ç”¨æœåŠ¡**:
1. å¹³å°åç«¯API (8000)
2. æ—¥å¿—å¤„ç†å™¨ (ä¾èµ–Redis)
3. ç»Ÿè®¡èšåˆå™¨
4. Timesetæ•°æ®ç¡®ä¿å™¨
5. å‰ç«¯ç•Œé¢ (9000)

**ä¸€é”®å¯åŠ¨**: `./start_all_services.sh`  
**ä¸€é”®åœæ­¢**: `./stop_all_services.sh`

---

*æœ€åæ›´æ–°: 2026-01-21*
