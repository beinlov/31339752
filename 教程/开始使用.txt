================================================================================
åƒµå°¸ç½‘ç»œç›‘æ§ç³»ç»Ÿ - å¿«é€Ÿå¼€å§‹æŒ‡å—
================================================================================

ã€ç³»ç»Ÿæ¦‚è¿°ã€‘

æœ¬ç³»ç»Ÿå®ç°äº†å®Œæ•´çš„åƒµå°¸ç½‘ç»œç›‘æ§æ•°æ®æµï¼š
  è¿œç«¯èœœç½ â†’ æ—¥å¿—ä¸Šä¼  â†’ æ—¥å¿—å¤„ç† â†’ æ•°æ®èšåˆ â†’ å‰ç«¯å±•ç¤º

ã€æ–°å¢åŠŸèƒ½ã€‘

âœ… ç»Ÿè®¡æ•°æ®èšåˆå™¨
   - è‡ªåŠ¨å®šæ—¶èšåˆï¼ˆæ¯30åˆ†é’Ÿï¼‰
   - ä»èŠ‚ç‚¹è¡¨èšåˆåˆ°ç»Ÿè®¡è¡¨
   - è§£å†³å‰ç«¯æ— æ•°æ®æ˜¾ç¤ºçš„é—®é¢˜

ã€å¿«é€Ÿå¼€å§‹ã€‘

================ æ­¥éª¤1: ç³»ç»Ÿæ£€æŸ¥ ================

è¿è¡Œå¿«é€Ÿæ£€æŸ¥è„šæœ¬ï¼š

  python quick_check.py

è¿™ä¼šæ£€æŸ¥ï¼š
  âœ… Python ç¯å¢ƒ
  âœ… ä¾èµ–åŒ…
  âœ… æ•°æ®åº“è¿æ¥
  âœ… å…³é”®æ–‡ä»¶
  âœ… æ•°æ®è¡¨

å¦‚æœæœ‰é—®é¢˜ï¼Œè¯·å…ˆè§£å†³å†ç»§ç»­ã€‚

================ æ­¥éª¤2: æµ‹è¯•èšåˆå™¨ ================

cd backend
python test_aggregator.py

é¢„æœŸè¾“å‡ºï¼š
  âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
  âœ… èŠ‚ç‚¹è¡¨æ£€æŸ¥é€šè¿‡
  âœ… èšåˆåŠŸèƒ½æ­£å¸¸
  âœ… ç»Ÿè®¡è¡¨æœ‰æ•°æ®

å¦‚æœèŠ‚ç‚¹è¡¨ä¸ºç©ºï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œéœ€è¦å…ˆä¸Šä¼ æ—¥å¿—ã€‚

================ æ­¥éª¤3: å¯åŠ¨æ‰€æœ‰æœåŠ¡ ================

æ–¹å¼A: ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

Windows:
  start_all_services.bat

Linux/Mac:
  chmod +x start_all_services.sh
  chmod +x stop_all_services.sh
  ./start_all_services.sh

è¿™ä¼šå¯åŠ¨ï¼š
  1. FastAPI åç«¯ (ç«¯å£ 8000)
  2. æ—¥å¿—å¤„ç†å™¨
  3. ç»Ÿè®¡èšåˆå™¨ (æ¯30åˆ†é’Ÿ)

æ–¹å¼B: åˆ†åˆ«å¯åŠ¨

1. å¯åŠ¨åç«¯:
   cd backend
   python main.py

2. å¯åŠ¨æ—¥å¿—å¤„ç†å™¨:
   cd backend/log_processor
   python main.py

3. å¯åŠ¨ç»Ÿè®¡èšåˆå™¨:
   cd backend
   python stats_aggregator/aggregator.py daemon 30

================ æ­¥éª¤4: æµ‹è¯•ä¸Šä¼  ================

python test_upload.py

è¿™ä¼šï¼š
  1. ä¸Šä¼ æµ‹è¯•æ—¥å¿—åˆ°æœ¬åœ°æœåŠ¡å™¨
  2. æ—¥å¿—å¤„ç†å™¨è‡ªåŠ¨å¤„ç†æ—¥å¿—
  3. å†™å…¥èŠ‚ç‚¹è¡¨
  4. ç­‰å¾…èšåˆå™¨èšåˆï¼ˆ30åˆ†é’Ÿæˆ–æ‰‹åŠ¨è§¦å‘ï¼‰

================ æ­¥éª¤5: æ‰‹åŠ¨èšåˆï¼ˆå¯é€‰ï¼‰================

å¦‚æœä¸æƒ³ç­‰30åˆ†é’Ÿï¼Œå¯ä»¥æ‰‹åŠ¨è§¦å‘ï¼š

cd backend
python stats_aggregator/aggregator.py once

è¿™ä¼šç«‹å³èšåˆæ‰€æœ‰æ•°æ®ã€‚

================ æ­¥éª¤6: éªŒè¯æ•ˆæœ ================

1. æ£€æŸ¥API:
   curl http://localhost:8000/api/province-amounts

   åº”è¯¥è¿”å› JSON æ•°æ®ï¼Œä¸æ˜¯é”™è¯¯ã€‚

2. æŸ¥çœ‹æ•°æ®åº“:
   mysql -u root -p123456 botnet
   
   mysql> SELECT COUNT(*) FROM botnet_nodes_mozi;
   mysql> SELECT COUNT(*) FROM china_botnet_mozi;
   mysql> SELECT COUNT(*) FROM global_botnet_mozi;
   
   ç»Ÿè®¡è¡¨åº”è¯¥æœ‰æ•°æ®ã€‚

3. è®¿é—®å‰ç«¯:
   æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®å‰ç«¯åœ°å€
   æŒ‰ Ctrl+F5 å¼ºåˆ¶åˆ·æ–°
   
   æ£€æŸ¥ï¼š
   âœ… åœ°å›¾ä¸Šæœ‰èŠ‚ç‚¹
   âœ… å·¦ä¾§æœ‰åŸå¸‚ç»Ÿè®¡
   âœ… å³ä¾§æœ‰æ•°æ®é¢æ¿

================ æ­¥éª¤7: ç›‘æ§è¿è¡Œ ================

æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š

# Linux/Mac
tail -f backend/stats_aggregator.log
tail -f backend/log_processor.log

# Windows (PowerShell)
Get-Content backend\stats_aggregator.log -Wait -Tail 50

æ—¥å¿—åº”è¯¥æ˜¾ç¤ºèšåˆæˆåŠŸçš„æ¶ˆæ¯ã€‚

================================================================================
ã€ç³»ç»Ÿæ¶æ„ã€‘
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è¿œç«¯èœœç½/ä¼ æ„Ÿå™¨                             â”‚
â”‚              (è¿è¡Œ remote_uploader.py)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“ HTTP POST /api/upload-logs
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»„ä»¶1: FastAPI åç«¯ (backend/main.py)                       â”‚
â”‚  - æ¥æ”¶è¿œç«¯æ—¥å¿—ä¸Šä¼                                            â”‚
â”‚  - ä¿å­˜åˆ° logs/mozi/YYYY-MM-DD.txt                          â”‚
â”‚  - æä¾›å‰ç«¯APIæ¥å£                                           â”‚
â”‚  ç«¯å£: 8000                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“ æ–‡ä»¶ç³»ç»Ÿç›‘æ§
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»„ä»¶2: æ—¥å¿—å¤„ç†å™¨ (backend/log_processor/main.py)           â”‚
â”‚  - ç›‘æ§ logs/ ç›®å½•                                           â”‚
â”‚  - è§£ææ—¥å¿—æ–‡ä»¶                                              â”‚
â”‚  - IPåœ°ç†ä½ç½®æŸ¥è¯¢                                            â”‚
â”‚  - å†™å…¥ botnet_nodes_{type} è¡¨                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“ å®šæ—¶èšåˆ (æ¯30åˆ†é’Ÿ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»„ä»¶3: ç»Ÿè®¡èšåˆå™¨ (backend/stats_aggregator/aggregator.py)  â”‚
â”‚  - ä»èŠ‚ç‚¹è¡¨è¯»å–æ•°æ®                                          â”‚
â”‚  - æŒ‰çœå¸‚èšåˆ â†’ china_botnet_{type}                         â”‚
â”‚  - æŒ‰å›½å®¶èšåˆ â†’ global_botnet_{type}                        â”‚
â”‚  - å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼Œè‡ªåŠ¨å®šæ—¶è¿è¡Œ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“ APIè¯»å–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»„ä»¶4: å‰ç«¯ (fronted/)                                      â”‚
â”‚  - åœ°å›¾å±•ç¤ºèŠ‚ç‚¹åˆ†å¸ƒ                                          â”‚
â”‚  - å·¦ä¾§çœå¸‚ç»Ÿè®¡                                              â”‚
â”‚  - å³ä¾§æ•°æ®é¢æ¿                                              â”‚
â”‚  - å…¨çƒæ„ŸæŸ“åˆ†å¸ƒ                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
ã€æ–‡ä»¶è¯´æ˜ã€‘
================================================================================

æ ¸å¿ƒç»„ä»¶ï¼š
  backend/main.py                    - FastAPI åç«¯ä¸»ç¨‹åº
  backend/log_processor/main.py      - æ—¥å¿—å¤„ç†å™¨ä¸»ç¨‹åº
  backend/stats_aggregator/aggregator.py - ç»Ÿè®¡èšåˆå™¨ä¸»ç¨‹åº (æ–°å¢)
  backend/config.py                  - ç»Ÿä¸€é…ç½®æ–‡ä»¶

å¯åŠ¨è„šæœ¬ï¼š
  start_all_services.bat             - Windowsä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
  start_all_services.sh              - Linux/Macä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
  stop_all_services.sh               - Linux/Macåœæ­¢æ‰€æœ‰æœåŠ¡
  backend/start_aggregator.bat       - Windowså¯åŠ¨èšåˆå™¨
  backend/start_aggregator.sh        - Linux/Macå¯åŠ¨èšåˆå™¨

æµ‹è¯•è„šæœ¬ï¼š
  quick_check.py                     - ç³»ç»Ÿå¿«é€Ÿæ£€æŸ¥
  test_upload.py                     - æµ‹è¯•æ—¥å¿—ä¸Šä¼ 
  backend/test_aggregator.py         - æµ‹è¯•ç»Ÿè®¡èšåˆå™¨
  backend/test_db.py                 - æµ‹è¯•æ•°æ®åº“è¿æ¥

è¿œç«¯è„šæœ¬ï¼š
  remote_uploader.py                 - è¿œç«¯æ—¥å¿—ä¸Šä¼ å®¢æˆ·ç«¯

æ–‡æ¡£ï¼š
  å¼€å§‹ä½¿ç”¨.txt                       - æœ¬æ–‡ä»¶
  ç»Ÿè®¡èšåˆå™¨ä½¿ç”¨æŒ‡å—.md               - è¯¦ç»†ä½¿ç”¨æŒ‡å—
  ç»Ÿè®¡èšåˆå™¨å®ç°æ€»ç»“.txt              - å®ç°æ€»ç»“
  backend/stats_aggregator/README.md - æŠ€æœ¯æ–‡æ¡£
  LOG_UPLOAD_API_GUIDE.md            - APIä¸Šä¼ æŒ‡å—
  QUICK_TEST_GUIDE.md                - å¿«é€Ÿæµ‹è¯•æŒ‡å—
  API_FIX_SUMMARY.md                 - APIä¿®å¤è¯´æ˜
  é—®é¢˜ä¿®å¤è¯´æ˜.txt                   - å‰ç«¯æ•°æ®æ˜¾ç¤ºé—®é¢˜ä¿®å¤

æ—¥å¿—æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼š
  backend/stats_aggregator.log       - èšåˆå™¨æ—¥å¿—
  backend/log_processor.log          - æ—¥å¿—å¤„ç†å™¨æ—¥å¿—
  backend/main.log                   - åç«¯æ—¥å¿—

================================================================================
ã€é…ç½®è¯´æ˜ã€‘
================================================================================

æ•°æ®åº“é…ç½® (backend/config.py):
  DB_CONFIG = {
      "host": "localhost",
      "user": "root",
      "password": "123456",      # æ”¹ä¸ºä½ çš„æ•°æ®åº“å¯†ç 
      "database": "botnet"
  }

APIå¯†é’¥ (backend/config.py):
  API_KEY = "KiypG4zWLXqnREqGPH8L2Oh9ybvi6Yh4"

èšåˆé—´éš”:
  é»˜è®¤: 30åˆ†é’Ÿ
  ä¿®æ”¹: python stats_aggregator/aggregator.py daemon 5  # æ”¹ä¸º5åˆ†é’Ÿ

================================================================================
ã€å¸¸è§é—®é¢˜ã€‘
================================================================================

Q1: å‰ç«¯æ²¡æœ‰æ•°æ®æ˜¾ç¤ºï¼Ÿ

æ£€æŸ¥æ¸…å•ï¼š
  1. åç«¯æ˜¯å¦è¿è¡Œï¼Ÿ
  2. æ—¥å¿—å¤„ç†å™¨æ˜¯å¦è¿è¡Œï¼Ÿ
  3. èšåˆå™¨æ˜¯å¦è¿è¡Œï¼Ÿ
  4. èŠ‚ç‚¹è¡¨æœ‰æ•°æ®å—ï¼ŸSELECT COUNT(*) FROM botnet_nodes_mozi;
  5. ç»Ÿè®¡è¡¨æœ‰æ•°æ®å—ï¼ŸSELECT COUNT(*) FROM china_botnet_mozi;
  6. APIè¿”å›æ•°æ®å—ï¼Ÿcurl http://localhost:8000/api/province-amounts
  7. æµè§ˆå™¨ç¼“å­˜æ¸…ç†äº†å—ï¼ŸCtrl+F5

è§£å†³ï¼š
  # æ‰‹åŠ¨è§¦å‘èšåˆ
  cd backend
  python stats_aggregator/aggregator.py once
  
  # æµ‹è¯•API
  curl http://localhost:8000/api/province-amounts
  
  # å‰ç«¯å¼ºåˆ¶åˆ·æ–°
  Ctrl+F5

Q2: èšåˆå™¨æŠ¥é”™ï¼Ÿ

æŸ¥çœ‹æ—¥å¿—ï¼š
  cat backend/stats_aggregator.log

å¸¸è§é”™è¯¯ï¼š
  - Table doesn't exist: èŠ‚ç‚¹è¡¨ä¸å­˜åœ¨ï¼Œéœ€è¦å…ˆå¤„ç†æ—¥å¿—
  - æ•°æ®åº“è¿æ¥å¤±è´¥: æ£€æŸ¥ backend/config.py é…ç½®
  - No data: èŠ‚ç‚¹è¡¨ä¸ºç©ºï¼Œéœ€è¦å…ˆä¸Šä¼ æ—¥å¿—

Q3: å¦‚ä½•ç«‹å³çœ‹åˆ°æ•ˆæœï¼Ÿ

ä¸æƒ³ç­‰30åˆ†é’Ÿï¼š
  cd backend
  python stats_aggregator/aggregator.py once

Q4: å¦‚ä½•ä¿®æ”¹èšåˆé—´éš”ï¼Ÿ

å¯åŠ¨æ—¶æŒ‡å®šï¼š
  python stats_aggregator/aggregator.py daemon 5  # 5åˆ†é’Ÿ
  python stats_aggregator/aggregator.py daemon 60 # 60åˆ†é’Ÿ

æˆ–ä¿®æ”¹å¯åŠ¨è„šæœ¬ï¼š
  ç¼–è¾‘ start_aggregator.bat æˆ– start_aggregator.sh
  ä¿®æ”¹æœ€åä¸€è¡Œçš„æ•°å­—

Q5: å¦‚ä½•åœæ­¢æ‰€æœ‰æœåŠ¡ï¼Ÿ

Windows:
  å…³é—­å¯¹åº”çš„å‘½ä»¤è¡Œçª—å£

Linux/Mac:
  ./stop_all_services.sh
  æˆ–
  kill $(cat pids.txt)

================================================================================
ã€æ€§èƒ½å»ºè®®ã€‘
================================================================================

æ•°æ®é‡ < 10ä¸‡èŠ‚ç‚¹:
  èšåˆé—´éš”: 30åˆ†é’Ÿ
  æ€§èƒ½: å®Œå…¨è¶³å¤Ÿ

æ•°æ®é‡ 10ä¸‡-100ä¸‡:
  èšåˆé—´éš”: 30-60åˆ†é’Ÿ
  è€ƒè™‘: æ·»åŠ ç´¢å¼•ä¼˜åŒ–

æ•°æ®é‡ > 100ä¸‡:
  èšåˆé—´éš”: 60åˆ†é’Ÿæˆ–æ›´é•¿
  è€ƒè™‘: åœ¨ä½å³°æœŸèšåˆï¼ˆå‡Œæ™¨ï¼‰
  ä¼˜åŒ–: åˆ†åŒºè¡¨ã€å¢é‡æ›´æ–°

================================================================================
ã€è·å–å¸®åŠ©ã€‘
================================================================================

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
   - backend/stats_aggregator.log
   - backend/log_processor.log
   - backend/main.log

2. è¿è¡Œæµ‹è¯•è„šæœ¬
   - python quick_check.py
   - python backend/test_aggregator.py
   - python test_upload.py

3. æŸ¥çœ‹æ–‡æ¡£
   - ç»Ÿè®¡èšåˆå™¨ä½¿ç”¨æŒ‡å—.md
   - backend/stats_aggregator/README.md

4. æ•°æ®åº“æ£€æŸ¥
   mysql -u root -p123456 botnet
   SHOW TABLES;
   SELECT COUNT(*) FROM botnet_nodes_mozi;
   SELECT * FROM china_botnet_mozi LIMIT 10;

================================================================================
ã€å®Œæˆæ£€æŸ¥æ¸…å•ã€‘
================================================================================

éƒ¨ç½²å®Œæˆåï¼Œç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

â–¡ Python 3.7+ å·²å®‰è£…
â–¡ ä¾èµ–åŒ…å·²å®‰è£… (pymysql, fastapi, uvicorn, watchdog)
â–¡ MySQL æ•°æ®åº“è¿è¡Œæ­£å¸¸
â–¡ backend/config.py é…ç½®æ­£ç¡®
â–¡ æ‰€æœ‰æœåŠ¡å·²å¯åŠ¨ï¼ˆåç«¯ã€æ—¥å¿—å¤„ç†å™¨ã€èšåˆå™¨ï¼‰
â–¡ èŠ‚ç‚¹è¡¨æœ‰æ•°æ®
â–¡ ç»Ÿè®¡è¡¨æœ‰æ•°æ®
â–¡ API è¿”å›æ­£å¸¸
â–¡ å‰ç«¯æ˜¾ç¤ºæ•°æ®

å…¨éƒ¨æ‰“å‹¾ï¼Ÿæ­å–œï¼ç³»ç»Ÿéƒ¨ç½²æˆåŠŸï¼ğŸ‰

================================================================================
å¼€å§‹ä½¿ç”¨ç³»ç»Ÿå§ï¼ç¥ä½¿ç”¨æ„‰å¿«ï¼
================================================================================

