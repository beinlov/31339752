# 节点通信记录查看功能使用说明

## 📋 功能概述

在后台管理系统的"节点监控与清除"界面中，新增了**节点通信记录查看**功能。用户可以点击任意节点条目，在弹出的详细弹窗中查看该IP的所有历史通信记录。

---

## ✨ 功能特性

### 1. **点击查看**
- 点击右侧表格中的任意节点行（除复选框和"复制IP"按钮外）
- 自动弹出该IP的通信记录详情窗口
- 支持键盘ESC关闭弹窗

### 2. **时间筛选**
- 支持按开始时间和结束时间筛选通信记录
- 使用日期时间选择器，方便快速选择
- 点击"查询"按钮应用筛选
- 点击"重置"按钮清除筛选条件

### 3. **分页浏览**
- 每页显示50条记录
- 支持首页、上一页、下一页、末页跳转
- 实时显示当前页码和总页数
- 显示当前查看的记录范围

### 4. **详细信息展示**
每条通信记录包含：
- **序号**：当前记录在总结果中的位置
- **通信时间**：节点与C2服务器通信的时间
- **地理位置**：国家 - 省份 - 城市
- **ISP**：互联网服务提供商
- **状态**：在线/离线状态徽章
- **数据接收时间**：系统接收该记录的时间

---

## 🎨 界面设计

### 样式特点
- **深色科技风**：与平台整体风格保持一致
- **渐变背景**：使用蓝色渐变营造科技感
- **流畅动画**：弹窗出现和消失有平滑过渡效果
- **响应式设计**：自适应不同屏幕尺寸

### 颜色方案
- 主色调：`#1a73e8` (蓝色)
- 高亮色：`#64b5f6` (浅蓝)
- 成功色：`#81c784` (绿色)
- 警告色：`#ef5350` (红色)

---

## 🔧 技术实现

### 前端组件
- **CommunicationModal.js**：通信记录弹窗组件
  - 使用 styled-components 构建样式
  - 使用 axios 调用后端API
  - 支持分页、筛选和加载状态

### 后端API
- **接口地址**：`GET /api/node-communications`
- **参数**：
  ```javascript
  {
    botnet_type: string,  // 僵尸网络类型（必需）
    ip: string,           // IP地址（必需）
    page: number,         // 页码（默认1）
    page_size: number,    // 每页数量（默认50）
    start_time: string,   // 开始时间（可选）
    end_time: string      // 结束时间（可选）
  }
  ```
- **响应数据**：
  ```javascript
  {
    status: "success",
    data: {
      communications: [...], // 通信记录数组
      total: number,         // 总记录数
      page: number,          // 当前页码
      page_size: number      // 每页数量
    }
  }
  ```

---

## 📝 使用示例

### 1. 查看节点通信记录

1. 进入"后台管理系统" → "节点监控与清除"
2. 在右侧节点列表中找到目标节点
3. 点击节点行（除复选框外的任意位置）
4. 弹窗自动打开并加载该IP的通信记录

### 2. 按时间筛选

1. 在弹窗顶部的筛选栏中：
   - 选择开始时间（例如：2026-01-01 00:00）
   - 选择结束时间（例如：2026-01-08 23:59）
2. 点击"🔍 查询"按钮
3. 查看筛选后的结果

### 3. 浏览多页数据

1. 使用底部分页控制：
   - 点击"下一页"查看后续记录
   - 点击"首页"/"末页"快速跳转
   - 查看页码信息了解当前位置

---

## ⚙️ 配置说明

### 修改每页显示数量
在 `CommunicationModal.js` 中修改：
```javascript
const [pageSize] = useState(50); // 改为你想要的数量
```

### 修改颜色主题
在 `CommunicationModal.js` 中修改 styled-components 的颜色值。

---

## 🐛 故障排查

### 问题1：点击节点无反应
**可能原因**：
- 后端服务未启动
- 通信记录表不存在

**解决方法**：
1. 确认后端服务正在运行
2. 检查数据库是否已完成迁移
3. 查看浏览器控制台的错误信息

### 问题2：显示"暂无通信记录"
**可能原因**：
- 该IP确实没有通信记录
- 时间筛选范围内没有数据

**解决方法**：
1. 点击"重置"清除筛选条件
2. 确认数据库中是否有该IP的记录

### 问题3：加载缓慢
**可能原因**：
- 数据量过大
- 网络延迟

**解决方法**：
1. 使用时间筛选缩小查询范围
2. 检查网络连接
3. 考虑为通信记录表添加索引

---

## 🚀 性能优化建议

### 数据库索引
为 `botnet_communications_{type}` 表添加索引：
```sql
CREATE INDEX idx_ip_time ON botnet_communications_ramnit(ip, communication_time);
```

### 前端优化
- 使用虚拟滚动处理大量数据
- 增加loading skeleton提升用户体验
- 考虑添加数据缓存机制

---

## 📚 相关文档

- [数据库重构总结](../backend/REFACTORING_SUMMARY.md)
- [部署指南](../backend/DEPLOYMENT_GUIDE.md)
- [API文档](../backend/router/node.py)

---

## 💡 后续改进建议

1. **导出功能**：支持将通信记录导出为CSV/Excel
2. **图表展示**：添加时间线图表显示通信频率
3. **地图标注**：在地图上标记通信路径
4. **实时更新**：使用WebSocket实时推送新的通信记录
5. **批量操作**：支持批量查看多个IP的通信记录

---

**功能已完成！** 🎉

如需帮助，请联系技术支持团队。
