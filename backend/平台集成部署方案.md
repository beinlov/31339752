# åƒµå°¸ç½‘ç»œå¹³å°é›†æˆéƒ¨ç½²æ–¹æ¡ˆ

## âœ… å¯è¡Œæ€§ç¡®è®¤

**ç»“è®ºï¼šå®Œå…¨å¯è¡Œï¼** ä½ çš„å¹³å°å·²ç»å®ç°äº†å®Œæ•´çš„å…ç™»å½•é›†æˆæ¥å£ï¼Œå¯ä»¥ç›´æ¥é›†æˆåˆ°å¤§å¹³å°ã€‚

---

## ğŸ“‹ å·²æœ‰çš„å…ç™»å½•é›†æˆæ¥å£

ä½ çš„å¹³å°åœ¨ `router/user_integration_apis.py` ä¸­å·²ç»å®ç°äº†ä»¥ä¸‹æ¥å£ï¼š

### 1. SSOå•ç‚¹ç™»å½•æ¥å£ï¼ˆå…ç™»å½•ï¼‰

```http
POST http://ä½ çš„æœåŠ¡å™¨IP:8000/api/user/sso-login
Content-Type: application/json

{
  "username": "user123",
  "password": "password123",
  "role": "è®¿å®¢"  // å¯é€‰ï¼šç®¡ç†å‘˜ã€æ“ä½œå‘˜ã€è®¿å®¢
}
```

**å“åº”**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "role": "è®¿å®¢",
  "username": "user123"
}
```

**ä½¿ç”¨åœºæ™¯**: å¤§å¹³å°ç”¨æˆ·ç‚¹å‡»è¿›å…¥å­ç³»ç»Ÿæ—¶ï¼Œå¤§å¹³å°è°ƒç”¨æ­¤æ¥å£éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œè·å–tokenåè·³è½¬ã€‚

---

### 2. ç”¨æˆ·æ•°æ®åŒæ­¥æ¥å£ï¼ˆå…ç™»å½•ï¼‰

#### 2.1 åˆ›å»º/æ›´æ–°ç”¨æˆ·
```http
POST http://ä½ çš„æœåŠ¡å™¨IP:8000/api/user/sync-user
X-API-Key: KiypG4zWLXqnREqGPH8L2Oh9ybvi6Yh4
Content-Type: application/json

{
  "username": "newuser",
  "password": "password123",
  "role": "è®¿å®¢"  // å¯é€‰
}
```

#### 2.2 æ‰¹é‡åŒæ­¥ç”¨æˆ·
```http
POST http://ä½ çš„æœåŠ¡å™¨IP:8000/api/user/sync-users-batch
X-API-Key: KiypG4zWLXqnREqGPH8L2Oh9ybvi6Yh4
Content-Type: application/json

{
  "users": [
    {"username": "user1", "password": "pass1", "role": "æ“ä½œå‘˜"},
    {"username": "user2", "password": "pass2", "role": "è®¿å®¢"}
  ]
}
```

#### 2.3 åˆ é™¤ç”¨æˆ·
```http
DELETE http://ä½ çš„æœåŠ¡å™¨IP:8000/api/user/sync-user
X-API-Key: KiypG4zWLXqnREqGPH8L2Oh9ybvi6Yh4
Content-Type: application/json

{
  "username": "olduser"
}
```

#### 2.4 æ‰¹é‡åˆ é™¤ç”¨æˆ·
```http
DELETE http://ä½ çš„æœåŠ¡å™¨IP:8000/api/user/sync-users-batch
X-API-Key: KiypG4zWLXqnREqGPH8L2Oh9ybvi6Yh4
Content-Type: application/json

{
  "usernames": ["user1", "user2", "user3"]
}
```

---

### 3. é…ç½®æŸ¥è¯¢æ¥å£ï¼ˆå…ç™»å½•ï¼‰

#### 3.1 æŸ¥è¯¢SSOé…ç½®
```http
GET http://ä½ çš„æœåŠ¡å™¨IP:8000/api/user/sso-config
```

#### 3.2 æŸ¥è¯¢åŒæ­¥æ¥å£é…ç½®
```http
GET http://ä½ çš„æœåŠ¡å™¨IP:8000/api/user/sync-config
```

---

## ğŸ”§ éƒ¨ç½²é…ç½®æ­¥éª¤

### æ­¥éª¤1ï¼šç¡®è®¤ç«¯å£å¼€æ”¾

ä½ çš„å¹³å°è¿è¡Œåœ¨ **8000ç«¯å£**ï¼ˆå·²åœ¨ `main.py` ä¸­é…ç½®ï¼‰ï¼š

```python
# backend/main.py ç¬¬933è¡Œ
uvicorn.run(app, host="0.0.0.0", port=8000)
```

**éœ€è¦åšçš„**ï¼š
```bash
# 1. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾8000ç«¯å£
netstat -ano | findstr :8000

# 2. å¦‚æœéœ€è¦å¼€æ”¾é˜²ç«å¢™ï¼ˆWindowsï¼‰
netsh advfirewall firewall add rule name="Botnet Platform" dir=in action=allow protocol=TCP localport=8000

# 3. å¦‚æœéœ€è¦å¼€æ”¾é˜²ç«å¢™ï¼ˆLinuxï¼‰
sudo ufw allow 8000/tcp
```

---

### æ­¥éª¤2ï¼šé…ç½®å®‰å…¨å‚æ•°

ç¼–è¾‘ `backend/config.py` æ–‡ä»¶ï¼š

#### 2.1 é…ç½®SSOæ¥å£ï¼ˆç¬¬67-82è¡Œï¼‰

```python
SSO_CONFIG = {
    # Tokenè¿‡æœŸæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
    "sso_token_expire_minutes": 60,  # å»ºè®®ï¼š60åˆ†é’Ÿ
    
    # æ˜¯å¦å¯ç”¨IPç™½åå•
    "enable_ip_whitelist": True,  # â¬…ï¸ ç”Ÿäº§ç¯å¢ƒå»ºè®®True
    
    # IPç™½åå•ï¼ˆæ·»åŠ å¤§å¹³å°çš„æœåŠ¡å™¨IPï¼‰
    "ip_whitelist": [
        "127.0.0.1",
        "localhost",
        "192.168.1.100",  # â¬…ï¸ æ·»åŠ å¤§å¹³å°çš„IPåœ°å€
        "10.0.0.50",      # â¬…ï¸ å¦‚æœæœ‰å¤šä¸ªIPï¼Œéƒ½åŠ ä¸Š
    ]
}
```

#### 2.2 é…ç½®ç”¨æˆ·åŒæ­¥æ¥å£ï¼ˆç¬¬88-113è¡Œï¼‰

```python
SYNC_CONFIG = {
    # æ˜¯å¦å¯ç”¨APIå¯†é’¥éªŒè¯
    "enable_api_key": True,  # â¬…ï¸ å¿…é¡»True
    
    # APIå¯†é’¥ï¼ˆç»™å¤§å¹³å°ä½¿ç”¨ï¼Œéœ€è¦ä¿å¯†ï¼‰
    "api_key": "ä½ çš„å¼ºå¯†ç _å»ºè®®32ä¸ªå­—ç¬¦ä»¥ä¸Š",  # â¬…ï¸ ä¿®æ”¹ä¸ºå¼ºå¯†ç 
    
    # æ˜¯å¦å¯ç”¨IPç™½åå•
    "enable_ip_whitelist": True,  # â¬…ï¸ ç”Ÿäº§ç¯å¢ƒå»ºè®®True
    
    # IPç™½åå•ï¼ˆå¤§å¹³å°çš„æœåŠ¡å™¨IPï¼‰
    "ip_whitelist": [
        "127.0.0.1",
        "localhost",
        "192.168.1.100",  # â¬…ï¸ æ·»åŠ å¤§å¹³å°çš„IP
    ],
    
    # é»˜è®¤ç”¨æˆ·è§’è‰²
    "default_role": "è®¿å®¢",
    
    # é»˜è®¤ç”¨æˆ·çŠ¶æ€
    "default_status": "ç¦»çº¿"
}
```

**ç”Ÿæˆå¼ºå¯†ç **:
```python
import secrets
api_key = secrets.token_hex(32)  # ç”Ÿæˆ64å­—ç¬¦çš„å¼ºå¯†ç 
print(api_key)
```

---

### æ­¥éª¤3ï¼šå¯åŠ¨å¹³å°æœåŠ¡

#### æ–¹å¼1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# Windows
cd d:\workspace\botnet
start_all.bat

# Linux
cd /path/to/botnet
./start_all.sh
```

#### æ–¹å¼2ï¼šæ‰‹åŠ¨å¯åŠ¨
```bash
cd d:\workspace\botnet\backend
uvicorn main:app --host 0.0.0.0 --port 8000
```

#### æ–¹å¼3ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# ä½¿ç”¨å¤šè¿›ç¨‹ + è‡ªåŠ¨é‡å¯
uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4 --log-level info
```

---

### æ­¥éª¤4ï¼šéªŒè¯æ¥å£å¯ç”¨æ€§

#### æµ‹è¯•1ï¼šSSOç™»å½•æ¥å£
```bash
curl -X POST http://ä½ çš„æœåŠ¡å™¨IP:8000/api/user/sso-login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

**é¢„æœŸå“åº”**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "role": "ç®¡ç†å‘˜",
  "username": "admin"
}
```

#### æµ‹è¯•2ï¼šç”¨æˆ·åŒæ­¥æ¥å£
```bash
curl -X POST http://ä½ çš„æœåŠ¡å™¨IP:8000/api/user/sync-user \
  -H "Content-Type: application/json" \
  -H "X-API-Key: ä½ é…ç½®çš„APIå¯†é’¥" \
  -d '{
    "username": "testuser",
    "password": "test123"
  }'
```

**é¢„æœŸå“åº”**:
```json
{
  "success": true,
  "message": "ç”¨æˆ· testuser åŒæ­¥æˆåŠŸï¼ˆå·²åˆ›å»ºï¼‰",
  "username": "testuser",
  "action": "created",
  "role": "è®¿å®¢"
}
```

---

## ğŸ” å®‰å…¨æœºåˆ¶è¯´æ˜

ä½ çš„å…ç™»å½•æ¥å£å·²å®ç°ä»¥ä¸‹å®‰å…¨æœºåˆ¶ï¼š

### SSOç™»å½•æ¥å£å®‰å…¨
- âœ… **å¯†ç éªŒè¯**ï¼šå¿…é¡»æä¾›æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç 
- âœ… **IPç™½åå•**ï¼šå¯é€‰é™åˆ¶è°ƒç”¨IPï¼ˆé…ç½®ä¸­enable_ip_whitelistï¼‰
- âœ… **Tokenè¿‡æœŸ**ï¼šè®¿é—®ä»¤ç‰Œ1å°æ—¶åè‡ªåŠ¨è¿‡æœŸ
- âœ… **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰ç™»å½•å°è¯•

### ç”¨æˆ·åŒæ­¥æ¥å£å®‰å…¨
- âœ… **APIå¯†é’¥éªŒè¯**ï¼šå¿…é¡»æä¾›æ­£ç¡®çš„X-API-Key
- âœ… **IPç™½åå•**ï¼šå¯é€‰é™åˆ¶è°ƒç”¨IP
- âœ… **æ“ä½œé™åˆ¶**ï¼šç¦æ­¢åˆ é™¤adminç”¨æˆ·
- âœ… **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰åŒæ­¥æ“ä½œ

---

## ğŸŒ å¤§å¹³å°é›†æˆç¤ºä¾‹ä»£ç 

### é›†æˆæ–¹æ¡ˆ1ï¼šSSOå•ç‚¹ç™»å½•è·³è½¬

**å¤§å¹³å°å‰ç«¯ä»£ç **ï¼ˆJavaScriptï¼‰:
```javascript
// ç”¨æˆ·ç‚¹å‡»"è¿›å…¥åƒµå°¸ç½‘ç»œç›‘æ§"æŒ‰é’®
async function enterBotnetSystem() {
  const username = getCurrentUser().username;  // ä»å¤§å¹³å°è·å–å½“å‰ç”¨æˆ·
  const password = getUserPassword();  // æˆ–ä½¿ç”¨ç»Ÿä¸€å¯†ç 
  
  try {
    // è°ƒç”¨å­ç³»ç»Ÿçš„SSOç™»å½•æ¥å£
    const response = await fetch('http://å­ç³»ç»ŸIP:8000/api/user/sso-login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        username: username,
        password: password,
        role: 'è®¿å®¢'  // æ ¹æ®å¤§å¹³å°ç”¨æˆ·è§’è‰²æ˜ å°„
      })
    });
    
    const data = await response.json();
    
    if (response.ok) {
      // è·å–tokenåï¼Œè·³è½¬åˆ°å­ç³»ç»Ÿå¹¶æºå¸¦token
      const token = data.access_token;
      window.open(`http://å­ç³»ç»ŸIP:8000/?token=${token}`, '_blank');
    } else {
      alert('ç™»å½•å¤±è´¥ï¼š' + data.detail);
    }
  } catch (error) {
    console.error('SSOç™»å½•å¤±è´¥:', error);
    alert('æ— æ³•è¿æ¥åˆ°åƒµå°¸ç½‘ç»œç›‘æ§ç³»ç»Ÿ');
  }
}
```

**å­ç³»ç»Ÿå‰ç«¯æ¥æ”¶token**:
```javascript
// å­ç³»ç»Ÿé¡µé¢åŠ è½½æ—¶
window.addEventListener('load', () => {
  const urlParams = new URLSearchParams(window.location.search);
  const token = urlParams.get('token');
  
  if (token) {
    // ä¿å­˜tokenåˆ°localStorage
    localStorage.setItem('access_token', token);
    
    // ç§»é™¤URLä¸­çš„tokenå‚æ•°ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
    window.history.replaceState({}, document.title, '/');
    
    // è®¾ç½®åç»­è¯·æ±‚çš„è®¤è¯å¤´
    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
  }
});
```

---

### é›†æˆæ–¹æ¡ˆ2ï¼šç”¨æˆ·æ•°æ®åŒæ­¥

**å¤§å¹³å°åç«¯ä»£ç **ï¼ˆPythonç¤ºä¾‹ï¼‰:
```python
import requests

# å½“å¤§å¹³å°åˆ›å»ºæ–°ç”¨æˆ·æ—¶ï¼ŒåŒæ­¥åˆ°å­ç³»ç»Ÿ
def sync_user_to_botnet(username, password, role="è®¿å®¢"):
    """åŒæ­¥ç”¨æˆ·åˆ°åƒµå°¸ç½‘ç»œç›‘æ§å­ç³»ç»Ÿ"""
    
    url = "http://å­ç³»ç»ŸIP:8000/api/user/sync-user"
    headers = {
        "Content-Type": "application/json",
        "X-API-Key": "ä½ é…ç½®çš„APIå¯†é’¥"  # âš ï¸ ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œä¸è¦ç¡¬ç¼–ç 
    }
    data = {
        "username": username,
        "password": password,
        "role": role
    }
    
    try:
        response = requests.post(url, json=data, headers=headers, timeout=10)
        response.raise_for_status()
        
        result = response.json()
        print(f"ç”¨æˆ·åŒæ­¥æˆåŠŸ: {result['message']}")
        return True
    except requests.exceptions.RequestException as e:
        print(f"ç”¨æˆ·åŒæ­¥å¤±è´¥: {e}")
        return False

# æ‰¹é‡åŒæ­¥ç”¨æˆ·
def batch_sync_users(users_list):
    """æ‰¹é‡åŒæ­¥ç”¨æˆ·"""
    url = "http://å­ç³»ç»ŸIP:8000/api/user/sync-users-batch"
    headers = {
        "Content-Type": "application/json",
        "X-API-Key": "ä½ é…ç½®çš„APIå¯†é’¥"
    }
    data = {
        "users": [
            {"username": u["username"], "password": u["password"], "role": u.get("role", "è®¿å®¢")}
            for u in users_list
        ]
    }
    
    response = requests.post(url, json=data, headers=headers, timeout=30)
    return response.json()
```

---

### é›†æˆæ–¹æ¡ˆ3ï¼šiframeåµŒå…¥ï¼ˆæ— ç¼é›†æˆï¼‰

**å¤§å¹³å°å‰ç«¯ä»£ç **:
```html
<!DOCTYPE html>
<html>
<head>
  <title>å¤§å¹³å° - åƒµå°¸ç½‘ç»œç›‘æ§</title>
  <style>
    #botnet-frame {
      width: 100%;
      height: calc(100vh - 60px);
      border: none;
    }
  </style>
</head>
<body>
  <div id="header">å¤§å¹³å°å¯¼èˆªæ ...</div>
  
  <iframe id="botnet-frame" src=""></iframe>
  
  <script>
    // ç”¨æˆ·è¿›å…¥æ­¤é¡µé¢æ—¶ï¼Œè‡ªåŠ¨SSOç™»å½•å¹¶åµŒå…¥
    async function loadBotnetSystem() {
      const user = getCurrentUser();
      
      // è°ƒç”¨SSOæ¥å£è·å–token
      const response = await fetch('http://å­ç³»ç»ŸIP:8000/api/user/sso-login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          username: user.username,
          password: user.password,  // æˆ–ä½¿ç”¨ç»Ÿä¸€å¯†ç /å¯†é’¥
          role: user.role
        })
      });
      
      const data = await response.json();
      const token = data.access_token;
      
      // åœ¨iframeä¸­åŠ è½½å­ç³»ç»Ÿå¹¶ä¼ é€’token
      document.getElementById('botnet-frame').src = 
        `http://å­ç³»ç»ŸIP:8000/?token=${token}`;
    }
    
    loadBotnetSystem();
  </script>
</body>
</html>
```

---

## ğŸ“Š ç½‘ç»œæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤§å¹³å°                              â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  å‰ç«¯åº”ç”¨    â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  åç«¯æœåŠ¡    â”‚            â”‚
â”‚  â”‚             â”‚         â”‚              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                   â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    HTTPè¯·æ±‚        â”‚
                    (å…ç™»å½•æ¥å£)     â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åƒµå°¸ç½‘ç»œç›‘æ§å¹³å° (ä½ çš„ç³»ç»Ÿ)                  â”‚
â”‚              IP: ä½ çš„æœåŠ¡å™¨IP                            â”‚
â”‚              Port: 8000                                 â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  å…ç™»å½•é›†æˆæ¥å£                       â”‚              â”‚
â”‚  â”‚  /api/user/sso-login                â”‚              â”‚
â”‚  â”‚  /api/user/sync-user                â”‚              â”‚
â”‚  â”‚  /api/user/sync-users-batch         â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚  å®‰å…¨æœºåˆ¶                            â”‚              â”‚
â”‚  â”‚  â€¢ APIå¯†é’¥éªŒè¯                       â”‚              â”‚
â”‚  â”‚  â€¢ IPç™½åå•                          â”‚              â”‚
â”‚  â”‚  â€¢ å¯†ç éªŒè¯                          â”‚              â”‚
â”‚  â”‚  â€¢ Tokenè¿‡æœŸæ§åˆ¶                     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  ä¸šåŠ¡åŠŸèƒ½                            â”‚              â”‚
â”‚  â”‚  â€¢ åƒµå°¸ç½‘ç»œç›‘æ§                      â”‚              â”‚
â”‚  â”‚  â€¢ èŠ‚ç‚¹ç®¡ç†                          â”‚              â”‚
â”‚  â”‚  â€¢ ç»Ÿè®¡åˆ†æ                          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. ç«¯å£é…ç½®
- âœ… **æ˜¯çš„ï¼Œåªéœ€å¼€æ”¾8000ç«¯å£**
- ç¡®ä¿é˜²ç«å¢™å…è®¸å¤–éƒ¨è®¿é—®8000ç«¯å£
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨Nginxåå‘ä»£ç†ï¼ˆ80/443ç«¯å£ï¼‰

### 2. ç½‘ç»œç¯å¢ƒ
å¦‚æœä½ çš„å¹³å°åœ¨**å†…ç½‘**ï¼Œå¤§å¹³å°éœ€è¦èƒ½è®¿é—®åˆ°ä½ çš„æœåŠ¡å™¨ï¼š
- æ–¹æ¡ˆ1ï¼šä¸¤ä¸ªç³»ç»Ÿåœ¨åŒä¸€å†…ç½‘
- æ–¹æ¡ˆ2ï¼šé…ç½®VPNæ‰“é€šç½‘ç»œ
- æ–¹æ¡ˆ3ï¼šæš´éœ²åˆ°å…¬ç½‘ï¼ˆéœ€è¦æ›´ä¸¥æ ¼çš„å®‰å…¨æªæ–½ï¼‰

### 3. CORSé…ç½®
ä½ çš„å¹³å°å·²é…ç½®å…è®¸è·¨åŸŸï¼ˆ`main.py` ç¬¬45è¡Œï¼‰ï¼š
```python
allow_origins=["*"],  # å…è®¸æ‰€æœ‰æº
```

ç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿®æ”¹ä¸ºå…·ä½“åŸŸåï¼š
```python
allow_origins=[
    "http://å¤§å¹³å°åŸŸå.com",
    "https://å¤§å¹³å°åŸŸå.com"
],
```

### 4. HTTPSæ”¯æŒ
ç”Ÿäº§ç¯å¢ƒå¼ºçƒˆå»ºè®®ä½¿ç”¨HTTPSï¼š
```bash
# ä½¿ç”¨Nginxåå‘ä»£ç†æ·»åŠ SSL
upstream botnet_backend {
    server localhost:8000;
}

server {
    listen 443 ssl;
    server_name ä½ çš„åŸŸå;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    location / {
        proxy_pass http://botnet_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] ä¿®æ”¹ `config.py` ä¸­çš„APIå¯†é’¥ä¸ºå¼ºå¯†ç 
- [ ] é…ç½®IPç™½åå•ï¼ˆæ·»åŠ å¤§å¹³å°çš„IPï¼‰
- [ ] å¼€æ”¾8000ç«¯å£ï¼ˆé˜²ç«å¢™é…ç½®ï¼‰
- [ ] å¯åŠ¨å¹³å°æœåŠ¡ï¼ˆ`start_all.bat`ï¼‰
- [ ] æµ‹è¯•SSOç™»å½•æ¥å£æ˜¯å¦å¯è®¿é—®
- [ ] æµ‹è¯•ç”¨æˆ·åŒæ­¥æ¥å£æ˜¯å¦å¯è®¿é—®
- [ ] æä¾›ä»¥ä¸‹ä¿¡æ¯ç»™å¤§å¹³å°å¼€å‘å›¢é˜Ÿï¼š
  - [ ] å¹³å°è®¿é—®åœ°å€ï¼š`http://ä½ çš„IP:8000`
  - [ ] APIå¯†é’¥ï¼š`ä½ é…ç½®çš„å¯†é’¥`
  - [ ] æ¥å£æ–‡æ¡£ï¼šæœ¬æ–‡æ¡£
  - [ ] é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼šadmin / admin123

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ5åˆ†é’Ÿé›†æˆï¼‰

1. **ä¿®æ”¹é…ç½®**ï¼ˆ2åˆ†é’Ÿï¼‰
```bash
cd d:\workspace\botnet\backend
notepad config.py  # ä¿®æ”¹ç¬¬76å’Œ94è¡Œçš„APIå¯†é’¥
```

2. **å¯åŠ¨æœåŠ¡**ï¼ˆ1åˆ†é’Ÿï¼‰
```bash
cd d:\workspace\botnet
start_all.bat
```

3. **æµ‹è¯•æ¥å£**ï¼ˆ2åˆ†é’Ÿï¼‰
```bash
# åœ¨æµè§ˆå™¨è®¿é—®
http://localhost:8000/api/user/sso-config

# æˆ–ä½¿ç”¨curlæµ‹è¯•
curl http://localhost:8000/api/user/sso-config
```

4. **æä¾›ç»™å¤§å¹³å°**
- å¹³å°åœ°å€ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:8000`
- APIå¯†é’¥ï¼š`ä½ åˆšæ‰é…ç½®çš„å¯†é’¥`
- é›†æˆæ¥å£ï¼šå‚è€ƒæœ¬æ–‡æ¡£ç¬¬2èŠ‚

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œæ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. **ç«¯å£è¢«å ç”¨**
```bash
netstat -ano | findstr :8000
# å¦‚æœæœ‰è¿›ç¨‹å ç”¨ï¼Œkillæ‰é‡å¯
```

2. **IPç™½åå•é…ç½®é”™è¯¯**
```python
# config.py æ£€æŸ¥IPæ ¼å¼æ˜¯å¦æ­£ç¡®
"ip_whitelist": ["192.168.1.100"]  # ç¡®ä¿IPæ­£ç¡®
```

3. **APIå¯†é’¥ä¸åŒ¹é…**
```bash
# å¤§å¹³å°è°ƒç”¨æ—¶Headerå¿…é¡»å®Œå…¨ä¸€è‡´
X-API-Key: KiypG4zWLXqnREqGPH8L2Oh9ybvi6Yh4
```

4. **æŸ¥çœ‹æ—¥å¿—**
```bash
# åç«¯æ—¥å¿—
cd d:\workspace\botnet\backend
type logs\main_app.log
```

---

## âœ… æ€»ç»“

**ä½ çš„å¹³å°å®Œå…¨æ»¡è¶³é›†æˆè¦æ±‚**ï¼š

1. âœ… å·²å®ç°å®Œæ•´çš„å…ç™»å½•SSOæ¥å£
2. âœ… å·²å®ç°ç”¨æˆ·æ•°æ®åŒæ­¥æ¥å£
3. âœ… å·²é…ç½®å®‰å…¨æœºåˆ¶ï¼ˆAPIå¯†é’¥ã€IPç™½åå•ï¼‰
4. âœ… æœåŠ¡è¿è¡Œåœ¨8000ç«¯å£
5. âœ… æ”¯æŒè·¨åŸŸè®¿é—®ï¼ˆCORSå·²é…ç½®ï¼‰

**åªéœ€è¦åšçš„**ï¼š
1. ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„APIå¯†é’¥
2. é…ç½®IPç™½åå•
3. å¼€æ”¾8000ç«¯å£
4. å¯åŠ¨æœåŠ¡

**å¤§å¹³å°éœ€è¦åšçš„**ï¼š
1. è°ƒç”¨SSOæ¥å£å®ç°å•ç‚¹ç™»å½•
2. æˆ–è°ƒç”¨åŒæ­¥æ¥å£ç®¡ç†ç”¨æˆ·
3. å°†ä½ çš„ç³»ç»ŸåµŒå…¥/è·³è½¬åˆ°å¤§å¹³å°

**é›†æˆæ—¶é—´**ï¼šé¢„è®¡1-2å°æ—¶å³å¯å®Œæˆï¼
