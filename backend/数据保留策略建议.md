# åƒµå°¸ç½‘ç»œå¹³å°æ•°æ®ä¿ç•™ç­–ç•¥å»ºè®®

## ä¸€ã€æ•°æ®é‡è¯„ä¼°

### å½“å‰æ•°æ®è§„æ¨¡
- **æ¯æ—¥æ¥æ”¶æ•°æ®é‡**ï¼š10ä¸ªåƒµå°¸ç½‘ç»œ Ã— 10-15ä¸‡æ¡/ç½‘ç»œ = **100-150ä¸‡æ¡/å¤©**
- **æ¯æœˆæ•°æ®é‡**ï¼šçº¦ **3000-4500ä¸‡æ¡**
- **æ•°æ®åº“å­˜å‚¨ç©ºé—´**ï¼š
  - é€šä¿¡è®°å½•è¡¨ï¼ˆ`botnet_communications_*`ï¼‰ï¼šçº¦ 2-3GB/æœˆï¼ˆæ¯æ¡çº¦100å­—èŠ‚ï¼‰
  - èŠ‚ç‚¹è¡¨ï¼ˆ`botnet_nodes_*`ï¼‰ï¼šç›¸å¯¹è¾ƒå°ï¼Œçº¦ 50-100MBï¼ˆå»é‡åï¼‰
  - ç»Ÿè®¡è¡¨ï¼šçº¦ 10MBï¼ˆèšåˆæ•°æ®ï¼‰
  - **æ€»è®¡**ï¼šæ¯æœˆçº¦ **2.5-4GB**

### ä¿ç•™ä¸€ä¸ªæœˆçš„å½±å“
#### âœ… ä¼˜åŠ¿
1. **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘æŸ¥è¯¢æ•°æ®é‡ï¼Œæå‡æŸ¥è¯¢é€Ÿåº¦
2. **å­˜å‚¨æˆæœ¬**ï¼šé™ä½æ•°æ®åº“å­˜å‚¨å‹åŠ›
3. **ç»´æŠ¤ç®€ä¾¿**ï¼šå‡å°‘ç´¢å¼•å¤§å°ï¼Œæé«˜å†™å…¥æ€§èƒ½

#### âš ï¸ é£é™©
1. **å†å²åˆ†æå—é™**ï¼šæ— æ³•è¿›è¡Œé•¿æœŸè¶‹åŠ¿åˆ†æ
2. **å–è¯éœ€æ±‚**ï¼šå¯èƒ½æ— æ³•æ»¡è¶³å®‰å…¨äº‹ä»¶æº¯æº
3. **ç»Ÿè®¡åå·®**ï¼šå­£èŠ‚æ€§å˜åŒ–ã€é•¿æœŸè§„å¾‹éš¾ä»¥å‘ç°

### å»ºè®®ï¼šä¿ç•™æœŸé™è°ƒæ•´
**æ¨èä¿ç•™ 3-6 ä¸ªæœˆ**çš„æ´»è·ƒæ•°æ®ï¼Œç†ç”±ï¼š
- 3-6ä¸ªæœˆçš„æ•°æ®é‡çº¦ **10-25GB**ï¼Œå¯¹ç°ä»£æ•°æ®åº“å®Œå…¨å¯æ§
- æ»¡è¶³ä¸­é•¿æœŸè¶‹åŠ¿åˆ†æéœ€æ±‚
- æ”¯æŒå­£åº¦æ€§å®‰å…¨æŠ¥å‘Šç”Ÿæˆ
- ä¿ç•™è¶³å¤Ÿçš„å¨èƒæƒ…æŠ¥ä»·å€¼

---

## äºŒã€æ•°æ®åˆ†å±‚ç®¡ç†æ–¹æ¡ˆï¼ˆæ¨èï¼‰

### æ–¹æ¡ˆæ¶æ„ï¼šçƒ­æ•°æ® + æ¸©æ•°æ® + å†·æ•°æ®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®åˆ†å±‚æ¶æ„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  çƒ­æ•°æ®å±‚ï¼ˆ1ä¸ªæœˆï¼‰    â”€â”€ MySQLåœ¨çº¿åº“                  â”‚
â”‚  â€¢ é€šä¿¡è®°å½•è¡¨                                         â”‚
â”‚  â€¢ èŠ‚ç‚¹è¡¨                                            â”‚
â”‚  â€¢ ç»Ÿè®¡è¡¨                                            â”‚
â”‚  â€¢ å®æ—¶æŸ¥è¯¢ï¼Œé«˜æ€§èƒ½                                   â”‚
â”‚                                                     â”‚
â”‚  æ¸©æ•°æ®å±‚ï¼ˆ2-6ä¸ªæœˆï¼‰  â”€â”€ MySQLå½’æ¡£åº“/åˆ†åŒºè¡¨            â”‚
â”‚  â€¢ æŒ‰æœˆåˆ†åŒºå­˜å‚¨                                       â”‚
â”‚  â€¢ æ”¯æŒå†å²æŸ¥è¯¢                                       â”‚
â”‚  â€¢ æŸ¥è¯¢æ€§èƒ½é€‚ä¸­                                       â”‚
â”‚                                                     â”‚
â”‚  å†·æ•°æ®å±‚ï¼ˆ>6ä¸ªæœˆï¼‰   â”€â”€ æ–‡ä»¶å½’æ¡£/å¯¹è±¡å­˜å‚¨             â”‚
â”‚  â€¢ å‹ç¼©JSON/Parquetæ ¼å¼                              â”‚
â”‚  â€¢ ä»…ç”¨äºæ·±åº¦åˆ†æå’Œå®¡è®¡                               â”‚
â”‚  â€¢ ä½æˆæœ¬å­˜å‚¨                                         â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†å±‚ç­–ç•¥è¯¦è§£

#### ğŸ”¥ çƒ­æ•°æ®å±‚ï¼ˆè¿‘1ä¸ªæœˆï¼‰
- **ä½ç½®**ï¼šMySQLä¸»æ•°æ®åº“
- **ç”¨é€”**ï¼šå®æ—¶ç›‘æ§ã€å¿«é€ŸæŸ¥è¯¢ã€ä»ªè¡¨ç›˜å±•ç¤º
- **æ€§èƒ½è¦æ±‚**ï¼šæ¯«ç§’çº§å“åº”
- **ä¿ç•™åŸå› **ï¼šæœ€é«˜è®¿é—®é¢‘ç‡ï¼Œä¸šåŠ¡æ ¸å¿ƒæ•°æ®

#### ğŸŒ¡ï¸ æ¸©æ•°æ®å±‚ï¼ˆ1-6ä¸ªæœˆï¼‰
- **ä½ç½®**ï¼š
  - æ–¹æ¡ˆ1ï¼šåŒä¸€æ•°æ®åº“ï¼Œä½¿ç”¨**è¡¨åˆ†åŒº**ï¼ˆæ¨èï¼‰
  - æ–¹æ¡ˆ2ï¼šç‹¬ç«‹çš„å½’æ¡£æ•°æ®åº“
- **ç”¨é€”**ï¼šå†å²è¶‹åŠ¿åˆ†æã€æœˆåº¦/å­£åº¦æŠ¥å‘Š
- **æ€§èƒ½è¦æ±‚**ï¼šç§’çº§å“åº”
- **å®ç°æ–¹å¼**ï¼šæŒ‰æœˆåˆ†åŒºè¡¨
  ```sql
  ALTER TABLE botnet_communications_mozi
  PARTITION BY RANGE (UNIX_TIMESTAMP(communication_time)) (
      PARTITION p202401 VALUES LESS THAN (UNIX_TIMESTAMP('2024-02-01')),
      PARTITION p202402 VALUES LESS THAN (UNIX_TIMESTAMP('2024-03-01')),
      ...
  );
  ```

#### â„ï¸ å†·æ•°æ®å±‚ï¼ˆ>6ä¸ªæœˆï¼‰
- **ä½ç½®**ï¼šå¯¹è±¡å­˜å‚¨ï¼ˆOSS/S3ï¼‰æˆ–æœ¬åœ°å½’æ¡£æ–‡ä»¶
- **æ ¼å¼**ï¼š
  - JSONå‹ç¼©æ ¼å¼ï¼ˆgzipï¼‰
  - Parquetåˆ—å¼å­˜å‚¨ï¼ˆæ¨èï¼Œä¾¿äºåˆ†æï¼‰
- **ç”¨é€”**ï¼š
  - å¹´åº¦å®‰å…¨æŠ¥å‘Š
  - æ·±åº¦å¨èƒæº¯æº
  - åˆè§„å®¡è®¡
- **è®¿é—®æ–¹å¼**ï¼šç¦»çº¿å¯¼å…¥åˆ†æå·¥å…·ï¼ˆå¦‚ ClickHouseã€Elasticsearchï¼‰

---

## ä¸‰ã€æ•°æ®æ¸…ç†ä¸å½’æ¡£å®æ–½æ–¹æ¡ˆ

### è‡ªåŠ¨åŒ–æ•°æ®ç®¡ç†æµç¨‹

```
æ¯æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼š
â”œâ”€ æ£€æµ‹è¶…è¿‡1ä¸ªæœˆçš„çƒ­æ•°æ®
â”œâ”€ å½’æ¡£åˆ°æ¸©æ•°æ®å±‚ï¼ˆåˆ†åŒºè¡¨ï¼‰
â”œâ”€ æ£€æµ‹è¶…è¿‡6ä¸ªæœˆçš„æ¸©æ•°æ®
â”œâ”€ å¯¼å‡ºä¸ºå‹ç¼©æ–‡ä»¶ï¼Œå­˜å‚¨åˆ°å†·æ•°æ®å±‚
â”œâ”€ åˆ é™¤å·²å½’æ¡£çš„æ•°æ®
â””â”€ è®°å½•å½’æ¡£æ—¥å¿—å’Œç»Ÿè®¡ä¿¡æ¯
```

### å®ç°æ­¥éª¤

#### 1ï¸âƒ£ é…ç½®æ•°æ®ä¿ç•™ç­–ç•¥
```python
# config.py æ·»åŠ é…ç½®
DATA_RETENTION_CONFIG = {
    "hot_data_days": 30,        # çƒ­æ•°æ®ä¿ç•™å¤©æ•°
    "warm_data_days": 180,      # æ¸©æ•°æ®ä¿ç•™å¤©æ•°ï¼ˆ1-6ä¸ªæœˆï¼‰
    "enable_archive": True,     # æ˜¯å¦å¯ç”¨å½’æ¡£
    "archive_path": "/data/archive/botnet",  # å½’æ¡£æ–‡ä»¶è·¯å¾„
    "archive_format": "parquet", # å½’æ¡£æ ¼å¼ï¼šjson, parquet
    "cleanup_enabled": True,    # æ˜¯å¦å¯ç”¨è‡ªåŠ¨æ¸…ç†
}
```

#### 2ï¸âƒ£ åˆ›å»ºæ•°æ®å½’æ¡£è„šæœ¬
```bash
backend/
â””â”€â”€ scripts/
    â”œâ”€â”€ data_archiver.py        # æ•°æ®å½’æ¡£è„šæœ¬
    â”œâ”€â”€ data_cleaner.py         # æ•°æ®æ¸…ç†è„šæœ¬
    â””â”€â”€ retention_manager.py    # ä¿ç•™ç­–ç•¥ç®¡ç†å™¨
```

#### 3ï¸âƒ£ è®¾ç½®å®šæ—¶ä»»åŠ¡
```bash
# Linux Cron
0 2 * * * cd /path/to/botnet/backend && python scripts/retention_manager.py >> /var/log/data_retention.log 2>&1

# Windowsè®¡åˆ’ä»»åŠ¡
schtasks /create /tn "BotnetDataRetention" /tr "python D:\workspace\botnet\backend\scripts\retention_manager.py" /sc daily /st 02:00
```

---

## å››ã€å…·ä½“æ¸…ç†ç­–ç•¥

### é€šä¿¡è®°å½•è¡¨ï¼ˆ`botnet_communications_*`ï¼‰

#### æ¸…ç†è§„åˆ™
```sql
-- åˆ é™¤è¶…è¿‡30å¤©çš„çƒ­æ•°æ®ï¼ˆå·²å½’æ¡£ï¼‰
DELETE FROM botnet_communications_mozi
WHERE communication_time < DATE_SUB(NOW(), INTERVAL 30 DAY)
AND archived = 1;  -- ä»…åˆ é™¤å·²å½’æ¡£æ•°æ®

-- åˆ†æ‰¹åˆ é™¤ï¼Œé¿å…é”è¡¨
DELETE FROM botnet_communications_mozi
WHERE communication_time < DATE_SUB(NOW(), INTERVAL 30 DAY)
AND archived = 1
LIMIT 10000;  -- æ¯æ¬¡åˆ é™¤1ä¸‡æ¡
```

#### å½’æ¡£å‰å¤„ç†
```python
# å½’æ¡£å‰ç»Ÿè®¡æ±‡æ€»
def archive_communications(botnet_type, start_date, end_date):
    """
    å½’æ¡£é€šä¿¡è®°å½•åˆ°æ–‡ä»¶
    
    æ­¥éª¤ï¼š
    1. å¯¼å‡ºæ•°æ®åˆ°Parquetæ–‡ä»¶
    2. éªŒè¯å½’æ¡£å®Œæ•´æ€§
    3. æ ‡è®°æ•°æ®ä¸ºå·²å½’æ¡£
    4. æ¸…ç†å·²å½’æ¡£æ•°æ®
    """
    # 1. å¯¼å‡ºæ•°æ®
    query = f"""
        SELECT * FROM botnet_communications_{botnet_type}
        WHERE communication_time >= %s
        AND communication_time < %s
        AND archived = 0
    """
    df = pd.read_sql(query, conn, params=[start_date, end_date])
    
    # 2. ä¿å­˜ä¸ºParquetï¼ˆå‹ç¼©æ¯”é«˜ï¼ŒæŸ¥è¯¢å¿«ï¼‰
    archive_file = f"/archive/{botnet_type}_{start_date.strftime('%Y%m')}.parquet"
    df.to_parquet(archive_file, compression='snappy')
    
    # 3. æ ‡è®°å·²å½’æ¡£
    update_query = f"""
        UPDATE botnet_communications_{botnet_type}
        SET archived = 1
        WHERE communication_time >= %s
        AND communication_time < %s
    """
    cursor.execute(update_query, [start_date, end_date])
    
    # 4. åˆ é™¤å·²å½’æ¡£æ•°æ®ï¼ˆåˆ†æ‰¹ï¼‰
    delete_in_batches(botnet_type, start_date, end_date)
```

### èŠ‚ç‚¹è¡¨ï¼ˆ`botnet_nodes_*`ï¼‰

#### æ¸…ç†è§„åˆ™
```sql
-- èŠ‚ç‚¹è¡¨ä¿ç•™ç­–ç•¥ï¼šä¿ç•™æ‰€æœ‰å†å²èŠ‚ç‚¹ï¼Œä½†æ ‡è®°ä¸ºinactive
-- åˆ é™¤è¶…è¿‡6ä¸ªæœˆæ— é€šä¿¡ä¸”å·²å½’æ¡£çš„inactiveèŠ‚ç‚¹
DELETE FROM botnet_nodes_mozi
WHERE status = 'inactive'
AND last_seen < DATE_SUB(NOW(), INTERVAL 180 DAY)
AND archived = 1;
```

#### æ¨èï¼šä¸åˆ é™¤èŠ‚ç‚¹è¡¨
- èŠ‚ç‚¹è¡¨æ•°æ®é‡å°ï¼ˆå»é‡åä»…æ•°ä¸‡åˆ°æ•°åä¸‡æ¡ï¼‰
- ä¿ç•™å®Œæ•´èŠ‚ç‚¹å†å²å¯¹å¨èƒæƒ…æŠ¥åˆ†ææœ‰ä»·å€¼
- å»ºè®®ï¼šä»…æ ‡è®°ä¸º`inactive`ï¼Œä¸ç‰©ç†åˆ é™¤

### ç»Ÿè®¡è¡¨ï¼ˆ`china_botnet_*`, `global_botnet_*`ï¼‰

#### æ¸…ç†è§„åˆ™
```sql
-- ç»Ÿè®¡è¡¨ä¿ç•™ç­–ç•¥ï¼šä¿ç•™æ‰€æœ‰å†å²ç»Ÿè®¡æ•°æ®
-- åŸå› ï¼šèšåˆåæ•°æ®é‡æå°ï¼Œå…·æœ‰é•¿æœŸåˆ†æä»·å€¼
-- ä¸å»ºè®®åˆ é™¤
```

---

## äº”ã€æ¨èå®æ–½æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šæ¸è¿›å¼å®æ–½ï¼ˆæ¨èæ–°æ‰‹ï¼‰

```
ç¬¬1å‘¨ï¼šå‡†å¤‡é˜¶æ®µ
â”œâ”€ åˆ›å»ºå½’æ¡£ç›®å½•ç»“æ„
â”œâ”€ ç¼–å†™å½’æ¡£è„šæœ¬
â””â”€ åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯

ç¬¬2å‘¨ï¼šè¯•è¿è¡Œ
â”œâ”€ æ‰‹åŠ¨å½’æ¡£æœ€æ—©çš„1ä¸ªæœˆæ•°æ®
â”œâ”€ éªŒè¯å½’æ¡£æ–‡ä»¶å®Œæ•´æ€§
â””â”€ æµ‹è¯•æ•°æ®æ¢å¤æµç¨‹

ç¬¬3å‘¨ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²
â”œâ”€ éƒ¨ç½²å®šæ—¶ä»»åŠ¡
â”œâ”€ ç›‘æ§å½’æ¡£æ—¥å¿—
â””â”€ è°ƒæ•´æ€§èƒ½å‚æ•°

ç¬¬4å‘¨ï¼šä¼˜åŒ–å®Œå–„
â”œâ”€ è¯„ä¼°å­˜å‚¨æˆæœ¬é™ä½æ•ˆæœ
â”œâ”€ è¯„ä¼°æŸ¥è¯¢æ€§èƒ½æå‡
â””â”€ æ–‡æ¡£åŒ–æµç¨‹
```

### æ–¹æ¡ˆBï¼šæ¿€è¿›å¼å®æ–½ï¼ˆé€‚åˆæœ‰ç»éªŒå›¢é˜Ÿï¼‰

```
ç«‹å³å®æ–½ï¼š
1. ç›´æ¥åˆ é™¤è¶…è¿‡6ä¸ªæœˆçš„æ•°æ®ï¼ˆå¤‡ä»½åï¼‰
2. ä¿ç•™è¿‘6ä¸ªæœˆæ•°æ®
3. éƒ¨ç½²è‡ªåŠ¨æ¸…ç†è„šæœ¬
4. æ¯æœˆæ¸…ç†è¶…è¿‡6ä¸ªæœˆçš„æ•°æ®
```

---

## å…­ã€å…³é”®æ³¨æ„äº‹é¡¹

### âš ï¸ åˆ é™¤å‰å¿…åš
1. **å…¨é‡å¤‡ä»½**ï¼šåˆ é™¤å‰å®Œæ•´å¤‡ä»½æ•°æ®åº“
2. **å½’æ¡£éªŒè¯**ï¼šç¡®ä¿å½’æ¡£æ–‡ä»¶å¯è¯»ä¸”å®Œæ•´
3. **åˆ†æ‰¹åˆ é™¤**ï¼šé¿å…ä¸€æ¬¡æ€§åˆ é™¤å¤§é‡æ•°æ®å¯¼è‡´é”è¡¨
   ```sql
   -- åˆ†æ‰¹åˆ é™¤ç¤ºä¾‹
   SET @batch_size = 10000;
   REPEAT
       DELETE FROM table_name WHERE condition LIMIT @batch_size;
   UNTIL ROW_COUNT() = 0 END REPEAT;
   ```
4. **ä¸šåŠ¡é€šçŸ¥**ï¼šæå‰é€šçŸ¥ç”¨æˆ·æ•°æ®ä¿ç•™ç­–ç•¥å˜æ›´

### âœ… æœ€ä½³å®è·µ
1. **é€æ­¥åˆ é™¤**ï¼šå…ˆåˆ é™¤3ä¸ªæœˆå¤–çš„æ•°æ®ï¼Œè§‚å¯Ÿ1å‘¨åå†åˆ é™¤æ›´å¤š
2. **ä¿ç•™å…ƒæ•°æ®**ï¼šåˆ é™¤è¯¦ç»†æ•°æ®å‰ï¼Œä¿ç•™ç»Ÿè®¡æ‘˜è¦
3. **ç›‘æ§æ€§èƒ½**ï¼šè§‚å¯Ÿåˆ é™¤å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“
4. **å¯æ¢å¤æ€§**ï¼šä¿ç•™è‡³å°‘ä¸€ä»½å†·å¤‡ä»½

---

## ä¸ƒã€æˆæœ¬æ•ˆç›Šåˆ†æ

### ä¿ç•™1ä¸ªæœˆ vs ä¿ç•™6ä¸ªæœˆ

| æŒ‡æ ‡ | ä¿ç•™1ä¸ªæœˆ | ä¿ç•™6ä¸ªæœˆ |
|------|----------|----------|
| å­˜å‚¨ç©ºé—´ | ~4GB | ~25GB |
| æŸ¥è¯¢æ€§èƒ½ | æå¿« | å¿« |
| åˆ†æèƒ½åŠ› | æœ‰é™ | è¾ƒå¼º |
| è¿ç»´æˆæœ¬ | ä½ | ä¸­ç­‰ |
| å¨èƒæƒ…æŠ¥ä»·å€¼ | ä½ | é«˜ |
| **æ¨èåº¦** | â­â­â­ | â­â­â­â­â­ |

### å»ºè®®é…ç½®
```yaml
æ¨èæ–¹æ¡ˆï¼š3å±‚åˆ†çº§å­˜å‚¨
- çƒ­æ•°æ®ï¼ˆMySQLï¼‰ï¼š1ä¸ªæœˆ  â†’ å®æ—¶æŸ¥è¯¢
- æ¸©æ•°æ®ï¼ˆMySQLåˆ†åŒºï¼‰ï¼š1-6ä¸ªæœˆ â†’ å†å²åˆ†æ
- å†·æ•°æ®ï¼ˆæ–‡ä»¶å½’æ¡£ï¼‰ï¼š>6ä¸ªæœˆ â†’ æ·±åº¦æŒ–æ˜

å­˜å‚¨æˆæœ¬ï¼š
- MySQLï¼ˆ30GBï¼‰ï¼šäº‘æ•°æ®åº“çº¦ Â¥200-500/æœˆ
- å¯¹è±¡å­˜å‚¨ï¼ˆ100GBï¼‰ï¼šçº¦ Â¥10-30/æœˆ
- æ€»æˆæœ¬ï¼šÂ¥210-530/æœˆ

æ€§èƒ½æå‡ï¼š
- æŸ¥è¯¢é€Ÿåº¦ï¼šæå‡ 40-60%
- å†™å…¥é€Ÿåº¦ï¼šæå‡ 20-30%
- ç´¢å¼•å¤§å°ï¼šå‡å°‘ 60-80%
```

---

## å…«ã€å¿«é€Ÿå¼€å§‹

### ç«‹å³å¯æ‰§è¡Œçš„æ“ä½œ

1. **è¯„ä¼°å½“å‰æ•°æ®é‡**
```sql
-- æŸ¥çœ‹å„è¡¨æ•°æ®é‡
SELECT 
    table_name,
    table_rows,
    ROUND(data_length/1024/1024, 2) AS data_mb,
    ROUND(index_length/1024/1024, 2) AS index_mb
FROM information_schema.tables
WHERE table_schema = 'botnet'
AND table_name LIKE 'botnet_%'
ORDER BY data_length DESC;
```

2. **åˆ†ææ•°æ®æ—¶é—´åˆ†å¸ƒ**
```sql
-- æŸ¥çœ‹æ•°æ®æ—¶é—´èŒƒå›´
SELECT 
    MIN(communication_time) as earliest,
    MAX(communication_time) as latest,
    DATEDIFF(MAX(communication_time), MIN(communication_time)) as days_span,
    COUNT(*) as total_records
FROM botnet_communications_mozi;
```

3. **æµ‹è¯•åˆ é™¤æ€§èƒ½**
```sql
-- æµ‹è¯•åˆ é™¤1ä¸‡æ¡æ•°æ®è€—æ—¶
SET @start_time = NOW();
DELETE FROM botnet_communications_mozi
WHERE communication_time < '2024-01-01'
LIMIT 10000;
SELECT TIMEDIFF(NOW(), @start_time) as deletion_time;
```

---

## ä¹ã€è„šæœ¬æ¨¡æ¿

æˆ‘å°†ä¸ºæ‚¨åˆ›å»ºä»¥ä¸‹è„šæœ¬ï¼š
1. `data_retention_config.py` - é…ç½®ç®¡ç†
2. `data_archiver.py` - æ•°æ®å½’æ¡£å·¥å…·
3. `data_cleaner.py` - æ•°æ®æ¸…ç†å·¥å…·
4. `retention_manager.py` - å®šæ—¶ä»»åŠ¡ç®¡ç†å™¨

éœ€è¦æˆ‘ç«‹å³ä¸ºæ‚¨ç”Ÿæˆè¿™äº›è„šæœ¬å—ï¼Ÿ
