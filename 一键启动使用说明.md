# Botnet Platform ä¸€é”®å¯åŠ¨ä½¿ç”¨è¯´æ˜

**ç‰ˆæœ¬**: v3.0  
**æ¶æ„**: åŸºäºå†…ç½®Workeræ¨¡å¼  
**æ›´æ–°æ—¥æœŸ**: 2026-01-15

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### Windowsç”¨æˆ·

```batch
# åŒå‡»è¿è¡Œï¼ˆæ¨èï¼‰
start_all_v3.bat

# æˆ–åœ¨å‘½ä»¤è¡Œè¿è¡Œ
cd d:\workspace\botnet
start_all_v3.bat
```

### Linux/Macç”¨æˆ·

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
chmod +x start_all_v3.sh stop_all.sh

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start_all_v3.sh
```

---

## ğŸ“‹ æœåŠ¡æ¸…å•

ä¸€é”®å¯åŠ¨è„šæœ¬å°†è‡ªåŠ¨å¯åŠ¨ä»¥ä¸‹**5ä¸ªæœåŠ¡**ï¼š

| åºå· | æœåŠ¡åç§° | ç«¯å£ | è¯´æ˜ |
|------|---------|------|------|
| 1 | **Redis Server** | 6379 | æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ |
| 2 | **æ—¥å¿—å¤„ç†å™¨** | - | æ•°æ®æ‹‰å–ä¸å¤„ç†ï¼ˆå†…ç½®Workerï¼‰ |
| 3 | **å¹³å°åç«¯API** | 8000 | FastAPIåç«¯æœåŠ¡ |
| 4 | **ç»Ÿè®¡èšåˆå™¨** | - | æ•°æ®ç»Ÿè®¡èšåˆï¼ˆ30åˆ†é’Ÿé—´éš”ï¼‰ |
| 5 | **å‰ç«¯ç•Œé¢** | 5173 | Viteå¼€å‘æœåŠ¡å™¨ |

---

## âœ… å¯åŠ¨å‰æ£€æŸ¥

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥ä»¥ä¸‹ç¯å¢ƒï¼š

### 1. Redis
- âœ… è‡ªåŠ¨æ£€æµ‹Redisæ˜¯å¦è¿è¡Œ
- âœ… å¦‚æœæœªè¿è¡Œï¼Œå°è¯•è‡ªåŠ¨å¯åŠ¨
- âš ï¸  å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œæç¤ºå®‰è£…æ–¹æ³•

### 2. Pythonç¯å¢ƒ
- âœ… æ£€æµ‹Pythonæ˜¯å¦å®‰è£…
- âœ… æ£€æµ‹å¿…è¦çš„ä¾èµ–åº“ï¼ˆredis, fastapi, pymysqlï¼‰
- âœ… ç¼ºå°‘ä¾èµ–æ—¶è‡ªåŠ¨å®‰è£…

### 3. Node.jsç¯å¢ƒï¼ˆå¯é€‰ï¼‰
- âœ… æ£€æµ‹Node.jsæ˜¯å¦å®‰è£…
- âš ï¸  å¦‚æœæœªå®‰è£…ï¼Œè·³è¿‡å‰ç«¯å¯åŠ¨ï¼Œä½†åç«¯ç…§å¸¸è¿è¡Œ
- âœ… æ£€æµ‹å‰ç«¯ä¾èµ–ï¼Œç¼ºå°‘æ—¶è‡ªåŠ¨å®‰è£…

---

## ğŸš€ å¯åŠ¨è¿‡ç¨‹

### Windowsç‰ˆæœ¬ (start_all_v3.bat)

```
[Step 1/6] æ£€æŸ¥RedisçŠ¶æ€...
[OK] Redis is running

[Step 2/6] æ£€æŸ¥Pythonç¯å¢ƒ...
[OK] Python 3.11.0 detected

[Step 3/6] æ£€æŸ¥Pythonä¾èµ–...
[OK] Python dependencies ready

[Step 4/6] æ£€æŸ¥Node.jsç¯å¢ƒ...
[OK] Node.js v18.16.0 detected

[Step 5/6] æ£€æŸ¥å‰ç«¯ä¾èµ–...
[OK] å‰ç«¯ä¾èµ–å·²å®‰è£…

[Step 6/6] å¯åŠ¨æœåŠ¡...
============================================================

[Starting 1/4] æ—¥å¿—å¤„ç†å™¨ (å†…ç½®Worker)...
[OK] æ—¥å¿—å¤„ç†å™¨å·²å¯åŠ¨

[Starting 2/4] å¹³å°åç«¯API (FastAPI)...
[OK] å¹³å°åç«¯å·²å¯åŠ¨ (http://localhost:8000)

[Starting 3/4] ç»Ÿè®¡èšåˆå™¨ (å®ˆæŠ¤è¿›ç¨‹)...
[OK] ç»Ÿè®¡èšåˆå™¨å·²å¯åŠ¨ (æ¯30åˆ†é’Ÿèšåˆä¸€æ¬¡)

[Starting 4/4] å‰ç«¯ç•Œé¢ (Vite)...
[OK] å‰ç«¯ç•Œé¢å·²å¯åŠ¨

============================================================
   æ‰€æœ‰æœåŠ¡å¯åŠ¨æˆåŠŸï¼
============================================================
```

---

## ğŸŒ è®¿é—®åœ°å€

### ä¸»è¦æœåŠ¡

| æœåŠ¡ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| **å‰ç«¯ç•Œé¢** | http://localhost:5173 | Webç•Œé¢ |
| **APIæ–‡æ¡£** | http://localhost:8000/docs | Swaggeræ–‡æ¡£ |
| **APIæ ¹è·¯å¾„** | http://localhost:8000 | åç«¯API |

### å¸¸ç”¨APIç«¯ç‚¹

- çœä»½ç»Ÿè®¡: http://localhost:8000/api/province-amounts
- å›½å®¶ç»Ÿè®¡: http://localhost:8000/api/country-amounts
- èŠ‚ç‚¹æ•°æ®: http://localhost:8000/api/nodes/test
- å¥åº·æ£€æŸ¥: http://localhost:8000/health

---

## ğŸ“Š æŸ¥çœ‹æœåŠ¡çŠ¶æ€

### æ–¹æ³•1: æŸ¥çœ‹çª—å£

Windowsä¼šå¼¹å‡º4ä¸ªå‘½ä»¤çª—å£ï¼š
1. **Botnet Log Processor** - æ—¥å¿—å¤„ç†å™¨
2. **Botnet API Backend** - å¹³å°åç«¯
3. **Botnet Stats Aggregator** - ç»Ÿè®¡èšåˆå™¨
4. **Botnet Frontend** - å‰ç«¯ç•Œé¢

### æ–¹æ³•2: æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶

```bash
# æ—¥å¿—å¤„ç†å™¨æ—¥å¿—
tail -f backend/logs/log_processor.log

# å¹³å°åç«¯æ—¥å¿—ï¼ˆWindowsæŸ¥çœ‹æ§åˆ¶å°çª—å£ï¼‰
# Linux/MacæŸ¥çœ‹
tail -f backend/logs/api_backend.log

# ç»Ÿè®¡èšåˆå™¨æ—¥å¿—
tail -f backend/logs/stats_aggregator.log

# å‰ç«¯æ—¥å¿—ï¼ˆLinux/Macï¼‰
tail -f backend/logs/frontend.log
```

### æ–¹æ³•3: ä½¿ç”¨è¯Šæ–­å·¥å…·

```bash
# æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€
python backend/scripts/check_queue_status.py

# æ£€æŸ¥æ•°æ®
python backend/scripts/check_test_data.py
```

---

## ğŸ›‘ åœæ­¢æœåŠ¡

### Windows

```batch
# æ–¹æ³•1: è¿è¡Œåœæ­¢è„šæœ¬ï¼ˆæ¨èï¼‰
stop_all.bat

# æ–¹æ³•2: æ‰‹åŠ¨å…³é—­æ‰€æœ‰å¼¹å‡ºçš„å‘½ä»¤çª—å£
```

### Linux/Mac

```bash
# è¿è¡Œåœæ­¢è„šæœ¬
./stop_all.sh

# æˆ–æ‰‹åŠ¨åœæ­¢
kill $(cat backend/logs/*.pid)
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: Rediså¯åŠ¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
[ERROR] Redis failed to start
```

**è§£å†³æ–¹æ¡ˆ**:

**Windows**:
1. ä¸‹è½½Redis: https://github.com/tporadowski/redis/releases
2. è§£å‹å¹¶è¿è¡Œ `redis-server.exe`
3. æˆ–ä½¿ç”¨Docker: `docker run -d -p 6379:6379 redis`

**Linux/Mac**:
```bash
# Ubuntu/Debian
sudo apt-get install redis-server

# Mac
brew install redis

# å¯åŠ¨
redis-server
```

---

### Q2: Pythonä¾èµ–å®‰è£…å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
[ERROR] Failed to install dependencies
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ‰‹åŠ¨å®‰è£…
pip install redis fastapi uvicorn pymysql

# å¦‚æœpipç‰ˆæœ¬è¿‡è€
python -m pip install --upgrade pip
pip install redis fastapi uvicorn pymysql

# ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple redis fastapi uvicorn pymysql
```

---

### Q3: å‰ç«¯æ— æ³•å¯åŠ¨

**é”™è¯¯ä¿¡æ¯**:
```
[WARNING] Node.js not found
```

**è§£å†³æ–¹æ¡ˆ**:

1. å®‰è£…Node.js: https://nodejs.org/ (å»ºè®®v16æˆ–ä»¥ä¸Š)
2. é‡æ–°è¿è¡Œå¯åŠ¨è„šæœ¬

æˆ–è·³è¿‡å‰ç«¯ï¼Œåªä½¿ç”¨åç«¯API:
```bash
# å‰ç«¯å¯é€‰ï¼Œåç«¯å¯ä»¥ç‹¬ç«‹è¿è¡Œ
# ç›´æ¥è®¿é—®API: http://localhost:8000/docs
```

---

### Q4: ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**:
```
ERROR: [Errno 10048] error while attempting to bind on address ('0.0.0.0', 8000)
```

**è§£å†³æ–¹æ¡ˆ**:

**Windows**:
```batch
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :8000

# ç»“æŸè¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F
```

**Linux/Mac**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i:8000

# ç»“æŸè¿›ç¨‹
kill <PID>
```

---

### Q5: æ•°æ®ä¸æ˜¾ç¤º

**ç—‡çŠ¶**: å‰ç«¯ç•Œé¢æ— æ•°æ®

**æ’æŸ¥æ­¥éª¤**:

1. **æ£€æŸ¥åç«¯APIæ˜¯å¦æ­£å¸¸**:
   ```bash
   curl http://localhost:8000/api/province-amounts
   ```

2. **æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æœ‰æ•°æ®**:
   ```bash
   python backend/scripts/check_test_data.py
   ```

3. **æ£€æŸ¥ç»Ÿè®¡èšåˆæ˜¯å¦è¿è¡Œ**:
   ```bash
   # æŸ¥çœ‹ç»Ÿè®¡èšåˆå™¨çª—å£æˆ–æ—¥å¿—
   tail -f backend/logs/stats_aggregator.log
   ```

4. **æ‰‹åŠ¨è§¦å‘ç»Ÿè®¡èšåˆ**:
   ```bash
   python backend/stats_aggregator/aggregator.py once
   ```

---

### Q6: Workeræœªå¯åŠ¨

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º"è¿œç¨‹æ‹‰å–æˆåŠŸ"ä½†æ•°æ®æœªå†™å…¥æ•°æ®åº“

**åŸå› **: æ–°æ¶æ„å·²ä½¿ç”¨å†…ç½®Workerï¼Œæ— éœ€å•ç‹¬å¯åŠ¨

**ç¡®è®¤**:
```bash
# æŸ¥çœ‹æ—¥å¿—å¤„ç†å™¨æ—¥å¿—
tail -f backend/logs/log_processor.log

# åº”è¯¥çœ‹åˆ°:
# [å†…ç½®Worker] å·²å¯ç”¨ - å°†å¯åŠ¨ 1 ä¸ªWorkeråç¨‹
# [OK] å†…ç½®Worker-1 å·²å¯åŠ¨
# [å†…ç½®Worker-1] å¼€å§‹å¤„ç†ä»»åŠ¡...
```

---

## ğŸ“ˆ æ€§èƒ½è°ƒä¼˜

### è°ƒæ•´Workeræ•°é‡

ç¼–è¾‘ `backend/config.py`:

```python
# å†…ç½®Workeré…ç½®
INTERNAL_WORKER_CONFIG = {
    'worker_count': 2,  # æ”¹ä¸º2ä¸ªæˆ–æ›´å¤š
    # ...
}
```

**å»ºè®®**:
- å•æ ¸CPU: 1ä¸ªWorker
- åŒæ ¸CPU: 2ä¸ªWorker
- å››æ ¸CPU: 4ä¸ªWorker

---

### è°ƒæ•´ç»Ÿè®¡èšåˆé—´éš”

ç¼–è¾‘å¯åŠ¨è„šæœ¬ï¼Œå°† `daemon 30` æ”¹ä¸ºå…¶ä»–å€¼:

```batch
REM Windows (start_all_v3.bat)
start "Botnet Stats Aggregator" cmd /k "cd /d %~dp0backend && python stats_aggregator\aggregator.py daemon 10"
REM ä»30åˆ†é’Ÿæ”¹ä¸º10åˆ†é’Ÿ
```

```bash
# Linux/Mac (start_all_v3.sh)
nohup python3 stats_aggregator/aggregator.py daemon 10 > "$SCRIPT_DIR/backend/logs/aggregator.log" 2>&1 &
# ä»30åˆ†é’Ÿæ”¹ä¸º10åˆ†é’Ÿ
```

---

## ğŸ” ç›‘æ§ä¸ç»´æŠ¤

### æ—¥å¸¸ç›‘æ§

```bash
# æ¯æ—¥æ£€æŸ¥è„šæœ¬
cd d:\workspace\botnet

# 1. æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€
python backend/scripts/check_queue_status.py

# 2. æ£€æŸ¥æ•°æ®é‡
python backend/scripts/check_test_data.py

# 3. æŸ¥çœ‹æ—¥å¿—ï¼ˆæœ€è¿‘100è¡Œï¼‰
tail -n 100 backend/logs/log_processor.log
tail -n 100 backend/logs/stats_aggregator.log
```

### å®šæœŸç»´æŠ¤

**æ¯å‘¨**:
- æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œå¿…è¦æ—¶è½®è½¬
- æ£€æŸ¥æ•°æ®åº“å¢é•¿æƒ…å†µ
- æ£€æŸ¥Rediså†…å­˜ä½¿ç”¨

**æ¯æœˆ**:
- å¤‡ä»½æ•°æ®åº“
- æ¸…ç†è¿‡æœŸæ—¥å¿—
- æ›´æ–°ä¾èµ–åº“

---

## ğŸ“ ç›®å½•ç»“æ„

```
botnet/
â”œâ”€â”€ start_all_v3.bat          â­ Windowsä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ start_all_v3.sh           â­ Linux/Macä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ stop_all.bat              â­ Windowsåœæ­¢è„šæœ¬
â”œâ”€â”€ stop_all.sh               â­ Linux/Macåœæ­¢è„šæœ¬
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py               # å¹³å°åç«¯API
â”‚   â”œâ”€â”€ config.py             # é…ç½®æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ log_processor/
â”‚   â”‚   â””â”€â”€ main.py           # æ—¥å¿—å¤„ç†å™¨ï¼ˆå†…ç½®Workerï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ stats_aggregator/
â”‚   â”‚   â””â”€â”€ aggregator.py     # ç»Ÿè®¡èšåˆå™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ logs/                 # æ—¥å¿—ç›®å½•
â”‚   â”‚   â”œâ”€â”€ log_processor.log
â”‚   â”‚   â”œâ”€â”€ stats_aggregator.log
â”‚   â”‚   â””â”€â”€ *.pid             # è¿›ç¨‹IDæ–‡ä»¶
â”‚   â”‚
â”‚   â””â”€â”€ scripts/              # è¯Šæ–­å·¥å…·
â”‚       â”œâ”€â”€ check_queue_status.py
â”‚       â””â”€â”€ check_test_data.py
â”‚
â””â”€â”€ fronted/                  # å‰ç«¯ç•Œé¢
    â”œâ”€â”€ package.json
    â””â”€â”€ src/
```

---

## ğŸ“ ä½¿ç”¨æµç¨‹

### é¦–æ¬¡éƒ¨ç½²

1. **å®‰è£…ç¯å¢ƒ**:
   - Python 3.9+
   - Node.js 16+
   - Redis
   - MySQL

2. **é…ç½®æ•°æ®åº“**:
   - ç¼–è¾‘ `backend/config.py`
   - è®¾ç½® `DB_CONFIG`

3. **é¦–æ¬¡å¯åŠ¨**:
   ```bash
   # Windows
   start_all_v3.bat
   
   # Linux/Mac
   chmod +x start_all_v3.sh
   ./start_all_v3.sh
   ```

4. **éªŒè¯**:
   - æ‰“å¼€ http://localhost:5173
   - æ£€æŸ¥æ•°æ®æ˜¾ç¤º

---

### æ—¥å¸¸ä½¿ç”¨

```bash
# å¯åŠ¨
start_all_v3.bat  # Windows
./start_all_v3.sh # Linux/Mac

# ç›‘æ§
python backend/scripts/check_queue_status.py

# åœæ­¢
stop_all.bat      # Windows
./stop_all.sh     # Linux/Mac
```

---

## âœ¨ æ–°æ¶æ„ä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| âœ… **ä¸€é”®å¯åŠ¨** | å•ä¸ªè„šæœ¬å¯åŠ¨æ‰€æœ‰æœåŠ¡ |
| âœ… **è‡ªåŠ¨æ£€æµ‹** | è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒå’Œä¾èµ– |
| âœ… **æ™ºèƒ½å¯åŠ¨** | ç¼ºå°‘ç»„ä»¶æ—¶ç»™å‡ºæç¤º |
| âœ… **å†…ç½®Worker** | æ— éœ€å•ç‹¬å¯åŠ¨worker.py |
| âœ… **ç»Ÿä¸€ç®¡ç†** | æ‰€æœ‰æœåŠ¡ç»Ÿä¸€å¯åœ |
| âœ… **è·¨å¹³å°** | æ”¯æŒWindowså’ŒLinux/Mac |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å†…ç½®Workerè¿ç§»**: `backend/INTERNAL_WORKER_MIGRATION.md`
- **å¿«é€Ÿå¯åŠ¨æŒ‡å—**: `backend/QUICK_START.md`
- **å®Œæ•´é…ç½®æŒ‡å—**: `backend/DATA_TRANSMISSION_COMPLETE_GUIDE.md`
- **Workerä¿®å¤**: `backend/WORKER_STUCK_FIX.md`

---

## ğŸ†˜ è·å–å¸®åŠ©

### æŸ¥çœ‹æ–‡æ¡£
```bash
cd backend
ls *.md  # æŸ¥çœ‹æ‰€æœ‰æ–‡æ¡£
```

### è¿è¡Œè¯Šæ–­
```bash
python backend/scripts/check_queue_status.py
python backend/scripts/check_test_data.py
```

### æŸ¥çœ‹æ—¥å¿—
```bash
tail -f backend/logs/log_processor.log
tail -f backend/logs/stats_aggregator.log
```

---

**ç‰ˆæœ¬**: v3.0  
**æ¶æ„**: å†…ç½®Workeræ¨¡å¼  
**æœ€åæ›´æ–°**: 2026-01-15

**ğŸ‰ äº«å—ä¸€é”®å¯åŠ¨çš„ä¾¿æ·ä½“éªŒï¼**
